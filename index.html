<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FedRAMP 20x Trust Center - Gyrus Systems</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light Mode Colors */
            --primary-500: #6366f1;
            --primary-600: #4f46e5;
            --accent-500: #06b6d4;
            --accent-600: #0891b2;
            --success-500: #10b981;
            --success-600: #059669;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            --danger-500: #ef4444;
            --danger-600: #dc2626;
            --info-500: #3b82f6;
            --info-600: #2563eb;
            --orange-500: #f97316;
            --orange-600: #ea580c;
            --enhancement-500: #3b82f6;
            --enhancement-600: #2563eb;
            
            /* Neutrals */
            --gray-25: #fcfcfd;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* Theme Variables */
            --bg-primary: var(--gray-25);
            --bg-secondary: white;
            --bg-accent: var(--gray-50);
            --text-primary: var(--gray-900);
            --text-secondary: var(--gray-700);
            --text-tertiary: var(--gray-600);
            --border-color: var(--gray-200);
            --backdrop-blur: rgba(255, 255, 255, 0.95);
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-accent: linear-gradient(135deg, var(--primary-500) 0%, var(--accent-500) 100%);
            --gradient-success: linear-gradient(135deg, var(--success-500) 0%, #34d399 100%);
            --gradient-card: linear-gradient(145deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
            --gradient-orange: linear-gradient(135deg, var(--orange-500) 0%, var(--orange-600) 100%);
            --gradient-enhancement: linear-gradient(135deg, var(--enhancement-500) 0%, #60a5fa 100%);
            
            --radius: 16px;
            --radius-sm: 8px;
            --radius-lg: 24px;
            --shadow-sm: 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-accent: #334155;
            --text-primary: #ffffff;
            --text-secondary: #e2e8f0;
            --text-tertiary: #cbd5e1;
            --border-color: #475569;
            --backdrop-blur: rgba(30, 41, 59, 0.95);
            --gradient-card: linear-gradient(145deg, rgba(30,41,59,0.9) 0%, rgba(30,41,59,0.7) 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gradient-primary);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        /* Enhancement Animations */
        @keyframes enhancement-pulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }
        }

        @keyframes continuous-improvement {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .enhancement-indicator {
            animation: enhancement-pulse 2s infinite;
        }

        .continuous-improvement {
            animation: continuous-improvement 2s infinite;
        }

        /* Header */
        .header {
            background: var(--backdrop-blur);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: var(--gradient-accent);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
            box-shadow: var(--shadow);
        }

        .title-section h1 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            font-size: 1.25rem;
        }

        .theme-toggle:hover {
            border-color: var(--primary-500);
            transform: scale(1.05);
        }

        .status-badge {
            background: var(--gradient-success);
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-lg);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 5px;
            margin: 15px 0;
            backdrop-filter: blur(10px);
        }

        [data-theme="dark"] .tab-navigation {
            background: rgba(255,255,255,0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        [data-theme="dark"] .tab-btn {
            color: white;
        }

        .tab-btn.active {
            background: var(--bg-secondary);
            color: var(--text-primary);
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .tab-btn.active {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Header Info Section */
        .header-info {
            background: var(--bg-accent);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            margin-top: 1rem;
        }

        .header-info-content {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .header-info-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .header-info-subtitle {
            margin-bottom: 0.5rem;
        }

        .header-info-meta {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
            font-size: 0.8rem;
        }

        .header-info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-secondary);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .compliance-badge {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-600);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius);
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid rgba(16, 185, 129, 0.2);
            margin-top: 0.5rem;
            display: inline-block;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Enhanced Stats Grid with 4th metric */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--gradient-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 2rem 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-accent);
        }

        .stat-card.enhancement::before {
            background: var(--gradient-enhancement);
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-500);
        }

        .stat-card.enhancement:hover {
            border-color: var(--enhancement-500);
        }

        .stat-value {
            font-size: 2.75rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .stat-value.primary {
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-value.success { color: var(--success-500); }
        .stat-value.danger { color: var(--danger-500); }
        .stat-value.info { color: var(--info-500); }
        .stat-value.enhancement { 
            color: var(--enhancement-500);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: 0.75rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-change.positive {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-500);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .stat-change.enhancement {
            background: rgba(59, 130, 246, 0.1);
            color: var(--enhancement-500);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        /* Enhancement Indicators */
        .enhancement-badge {
            background: var(--gradient-enhancement);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-lg);
            font-size: 0.75rem;
            font-weight: 700;
            display: inline-block;
            margin-top: 0.5rem;
            box-shadow: var(--shadow-sm);
            animation: enhancement-pulse 3s infinite;
        }

        .enhancement-opportunity {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: var(--radius-sm);
            padding: 0.75rem;
            margin: 0.5rem 0;
        }

        .enhancement-opportunity .title {
            font-weight: 600;
            color: var(--enhancement-600);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .enhancement-opportunity .description {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Update Info */
        .update-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .update-card {
            background: var(--gradient-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.25rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .update-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-500);
        }

        .update-icon {
            font-size: 1.5rem;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-accent);
            border-radius: var(--radius-sm);
            color: white;
            box-shadow: var(--shadow);
        }

        .update-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.25rem;
        }

        .update-time {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Trust Center */
        .trust-center-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .trust-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .trust-card {
            background: var(--gradient-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .trust-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-500);
        }

        .trust-card-header {
            background: var(--gradient-accent);
            color: white;
            padding: 1.5rem;
        }

        .trust-card-title {
            font-size: 1.125rem;
            font-weight: 700;
            margin: 0;
        }

        .trust-card-content {
            padding: 2rem;
        }

        .trust-item {
            margin-bottom: 1.25rem;
            line-height: 1.6;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .trust-item:last-child {
            margin-bottom: 0;
        }

        .trust-item strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .trust-link {
            color: var(--primary-500);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .trust-link:hover {
            color: var(--primary-600);
            text-decoration: underline;
        }

        .materials-section {
            margin-bottom: 1.5rem;
            padding: 1.25rem;
            background: var(--bg-accent);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        .materials-section:last-child {
            margin-bottom: 0;
        }

        .materials-header {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .materials-list {
            margin: 0;
            padding-left: 1.5rem;
            color: var(--text-secondary);
        }

        .materials-list li {
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        /* KSI Section */
        .ksi-section {
            background: var(--gradient-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .ksi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .ksi-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-select, .search-box {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            background: var(--bg-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .filter-select {
            cursor: pointer;
        }

        .search-box {
            min-width: 200px;
        }

        .filter-select:focus, .search-box:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-box::placeholder {
            color: var(--text-tertiary);
        }

        .filter-chips {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .filter-chip {
            background: var(--bg-accent);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: var(--shadow-sm);
        }

        .filter-chip.active {
            background: var(--gradient-accent);
            color: white;
            transform: scale(1.05);
            box-shadow: var(--shadow);
        }

        .filter-chip:hover:not(.active) {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        /* KSI Grid */
        .ksi-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        }

        .ksi-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.75rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .ksi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: var(--border-color);
            transition: all 0.3s ease;
        }

        .ksi-card.passed::before { background: var(--gradient-success); }
        .ksi-card.failed::before { background: linear-gradient(135deg, var(--danger-500), #f87171); }
        .ksi-card.warning::before { background: linear-gradient(135deg, var(--warning-500), #fbbf24); }
        .ksi-card.enhancement::before { background: var(--gradient-enhancement); }

        .ksi-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-500);
        }

        .ksi-card.enhancement:hover {
            border-color: var(--enhancement-500);
        }

        .ksi-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .ksi-id {
            font-weight: 800;
            color: var(--text-primary);
            font-size: 0.875rem;
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-accent);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .ksi-status {
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: var(--shadow-sm);
        }

        .status-passed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-600);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-failed {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-600);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-600);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-enhancement {
            background: rgba(59, 130, 246, 0.1);
            color: var(--enhancement-600);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .ksi-category {
            background: var(--bg-accent);
            color: var(--text-secondary);
            padding: 0.375rem 1rem;
            border-radius: var(--radius-lg);
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: inline-block;
            border: 1px solid var(--border-color);
        }

        .ksi-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .ksi-result {
            background: var(--bg-accent);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin: 1rem 0;
        }

        .result-summary {
            font-size: 0.875rem;
            line-height: 1.5;
            color: var(--text-primary);
            font-weight: 500;
        }

        .ksi-meta {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin: 1.25rem 0;
        }

        .meta-item {
            background: var(--bg-accent);
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .meta-value {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .meta-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-top: 0.25rem;
        }

        .ksi-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            text-transform: none;
            letter-spacing: 0px;
            white-space: nowrap;
        }

        .action-btn.primary {
            background: var(--gradient-accent);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .action-btn.secondary {
            background: var(--bg-accent);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .action-btn.secondary:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        .action-btn.danger {
            background: var(--danger-500);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .action-btn.danger:hover {
            background: var(--danger-600);
            transform: translateY(-2px);
        }

        .action-btn.enhancement {
            background: var(--gradient-enhancement);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .action-btn.enhancement:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Loading state */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
            flex-direction: column;
            gap: 1rem;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modals */
        .cli-modal, .why-modal, .markdown-modal, .commands-modal, .poam-modal, .enhancement-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .cli-modal.active, .why-modal.active, .markdown-modal.active, .commands-modal.active, .poam-modal.active, .enhancement-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .cli-modal-content, .why-modal-content, .markdown-modal-content, .commands-modal-content, .poam-modal-content, .enhancement-modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .commands-modal-content, .poam-modal-content {
            max-width: 1000px;
        }

        .cli-modal-header, .why-modal-header, .markdown-modal-header, .commands-modal-header, .poam-modal-header, .enhancement-modal-header {
            background: var(--gradient-accent);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: center;
        }

        .poam-modal-header, .enhancement-modal-header {
            background: var(--gradient-enhancement);
        }

        .cli-modal-title, .why-modal-title, .markdown-modal-title, .commands-modal-title, .poam-modal-title, .enhancement-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .cli-content, .why-modal-body, .markdown-modal-body, .commands-modal-body, .poam-modal-body, .enhancement-modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
        }

        .cli-content {
            font-family: 'Courier New', monospace;
            background: var(--bg-accent);
            color: var(--text-primary);
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* POA&M Modal Specific Styles */
        .poam-tier-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: var(--bg-accent);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        .tier-btn {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
        }

        .tier-btn.active, .tier-btn:hover {
            border-color: var(--enhancement-500);
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        .tier-content {
            display: none;
        }

        .tier-content.active {
            display: block;
        }

        .poam-summary {
            background: var(--bg-accent);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .poam-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .poam-stat {
            text-align: center;
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .poam-stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .poam-stat-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .poam-list {
            margin-top: 1.5rem;
        }

        .poam-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .poam-item:hover {
            border-color: var(--enhancement-500);
            box-shadow: var(--shadow);
        }

        .poam-header {
            background: var(--bg-accent);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .poam-header:hover {
            background: var(--border-color);
        }

        .poam-title {
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .poam-expand-btn {
            background: none;
            border: none;
            color: var(--text-tertiary);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.25rem;
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .poam-expand-btn:hover {
            color: var(--text-primary);
        }

        .poam-expand-btn.expanded {
            transform: rotate(180deg);
        }

        .poam-details {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .poam-details.expanded {
            display: block;
        }

        .poam-info {
            background: var(--bg-accent);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin: 1rem 0;
        }

        .poam-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .poam-meta-item {
            background: var(--bg-accent);
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .poam-meta-value {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .poam-meta-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-top: 0.25rem;
        }

        /* Data Source Badge Styles */
        .data-source-badge {
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .data-source-badge.comprehensive {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-600);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .data-source-badge.fallback {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-600);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .data-source-badge.limited {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-600);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .commands-summary {
            background: var(--bg-accent);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .commands-summary-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .commands-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .command-stat {
            text-align: center;
            background: var(--bg-secondary);
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .command-stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .command-stat-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .commands-list {
            margin-top: 1.5rem;
        }

        .command-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .command-item:hover {
            border-color: var(--primary-500);
            box-shadow: var(--shadow);
        }

        .command-header {
            background: var(--bg-accent);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .command-header:hover {
            background: var(--border-color);
        }

        .command-title {
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .command-expand-btn {
            background: none;
            border: none;
            color: var(--text-tertiary);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.25rem;
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .command-expand-btn:hover {
            color: var(--text-primary);
        }

        .command-expand-btn.expanded {
            transform: rotate(180deg);
        }

        .command-details {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .command-details.expanded {
            display: block;
        }

        .command-code {
            background: var(--bg-accent);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: var(--text-primary);
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: auto;
        }

        .command-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .command-meta-item {
            background: var(--bg-accent);
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .command-meta-value {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .command-meta-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-top: 0.25rem;
        }

        .command-status {
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .command-status.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-600);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .command-status.failed {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-600);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .command-status.unknown {
            background: var(--bg-accent);
            color: var(--text-tertiary);
            border: 1px solid var(--border-color);
        }

        .no-commands-message {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }

        .no-commands-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .tier-indicator {
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tier-compliance {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-600);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .tier-enhancement {
            background: rgba(59, 130, 246, 0.1);
            color: var(--enhancement-600);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .tier-staleness {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-600);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        /* Trust Center styles */
        .trust-center-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .trust-center-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .trust-center-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .trust-center-subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .compliance-badge-large {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            font-weight: 600;
        }

        .quick-access-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .access-card {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .access-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .access-card .card-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .access-card h3 {
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .access-card p {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .access-btn {
            background: var(--gradient-accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .access-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .trust-section {
            background: var(--bg-secondary);
            color: var(--text-primary);
            margin: 30px 0;
            padding: 30px;
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .trust-section h2 {
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .trust-section p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .trust-section h4 {
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 1rem;
            }

            .header-top {
                flex-direction: column;
                text-align: center;
            }

            .header-info-meta {
                flex-direction: column;
                gap: 0.75rem;
            }

            .container {
                padding: 0 1rem;
                margin: 1rem auto;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .ksi-header {
                flex-direction: column;
                align-items: stretch;
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .ksi-grid {
                grid-template-columns: 1fr;
            }

            .cli-modal, .why-modal, .commands-modal, .poam-modal, .enhancement-modal {
                padding: 1rem;
            }

            .commands-modal-content, .poam-modal-content, .enhancement-modal-content {
                max-height: 90vh;
            }

            .commands-modal-header, .poam-modal-header, .enhancement-modal-header {
                padding: 1rem 1.5rem;
            }

            .commands-modal-body, .poam-modal-body, .enhancement-modal-body {
                padding: 1.5rem;
            }

            .quick-access-grid {
                grid-template-columns: 1fr;
            }

            .poam-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .poam-meta {
                grid-template-columns: repeat(2, 1fr);
            }

            .tier-btn {
                padding: 0.75rem;
                font-size: 0.875rem;
            }
        }

        /* Utilities */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-top">
                <div class="logo-section">
                    <div class="logo"></div>
                    <div class="title-section">
                        <h1>FedRAMP 20x Trust Center</h1>
                        <div class="subtitle">Gyrus Systems</div>
                    </div>
                </div>
                <div class="header-right">
                    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                        <span id="theme-icon">üåô</span>
                    </button>
                    <div class="status-badge">
                        <span>üõ°Ô∏è</span>
                        <span>FedRAMP 20x Low - In Process</span>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="showTab('compliance')">üîç Compliance Dashboard</button>
                <button class="tab-btn" onclick="showTab('trust-center')">üõ°Ô∏è Trust Center (RFC-0011)</button>
            </div>

            <div class="header-info">
                <div class="header-info-content">
                    <div class="header-info-title">Three-Tier POA&M System</div>
                    <div class="header-info-subtitle">üö® Compliance Tracking | üìà Enhancement Opportunities | üïí Evidence Currency</div>
                    <div class="header-info-meta">
                        <div class="header-info-item">
                            <span>‚è∞</span>
                            <span>Last updated: <span id="header-timestamp">Loading...</span></span>
                        </div>
                        <div class="header-info-item">
                            <span class="continuous-improvement">üöÄ</span>
                            <span>CONTINUOUS IMPROVEMENT ACTIVE</span>
                        </div>
                    </div>
                    <div class="compliance-badge">
                        Compliant with RFC-0008 (Continuous Reporting) and RFC-0011 (Trust Center Requirements)
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Tab 1 - Compliance Dashboard -->
    <div id="compliance-tab" class="tab-content active">
        <div class="container">
            <!-- Enhanced Key Metrics with 4th card -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value primary" id="overall-score">74.5%</div>
                    <div class="stat-label">Overall Compliance</div>
                    <div class="stat-change positive">‚Üó +2.1% this week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value success" id="passed-count">38</div>
                    <div class="stat-label">KSIs Passed</div>
                    <div class="stat-change positive">‚Üó +3 from last validation</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value danger" id="failed-count">9</div>
                    <div class="stat-label">KSIs Failed</div>
                    <div class="stat-change positive">‚Üò -2 from last validation</div>
                </div>
                <div class="stat-card enhancement">
                    <div class="stat-value enhancement" id="enhancement-count">12</div>
                    <div class="stat-label">Enhancement Opportunities</div>
                    <div class="stat-change enhancement">üìà Proactive Improvement</div>
                </div>
            </div>

            <!-- Last Updated Information -->
            <div class="update-info">
                <div class="update-card">
                    <div class="update-icon">‚è∞</div>
                    <div class="update-content">
                        <div class="update-label">Last Updated</div>
                        <div class="update-time" id="last-updated">Loading...</div>
                    </div>
                </div>
                <div class="update-card">
                    <div class="update-icon">üîÑ</div>
                    <div class="update-content">
                        <div class="update-label">Next Update</div>
                        <div class="update-time" id="next-update">Every 24 hours</div>
                    </div>
                </div>
                <div class="update-card">
                    <div class="update-icon">üìä</div>
                    <div class="update-content">
                        <div class="update-label">Three-Tier POA&M</div>
                        <div class="update-time" style="cursor: pointer; color: var(--enhancement-500); text-decoration: underline;">
                            <button onclick="window.showPOAMModal()" style="background: none; border: none; color: inherit; text-decoration: underline; cursor: pointer; font-size: inherit; font-weight: inherit;">View Analysis</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trust Center Section -->
            <div class="trust-center-section">
                <h2 class="section-title">üõ°Ô∏è Trust Center</h2>
                <div class="trust-grid">
                    <!-- FedRAMP Authorization Data -->
                    <div class="trust-card">
                        <div class="trust-card-header">
                            <h3 class="trust-card-title">üî∑ FedRAMP Authorization Data (RFC-0011)</h3>
                        </div>
                        <div class="trust-card-content">
                            <div class="trust-item">
                                <strong>Service Description:</strong> Gyrus Systems 
                            </div>
                            <div class="trust-item">
                                <strong>Authorization Scope:</strong> FedRAMP 20x Low Authorization
                            </div>
                            <div class="trust-item">
                                <strong>FedRAMP Marketplace:</strong> <a href="https://marketplace.fedramp.gov" target="_blank" class="trust-link">View Listing</a>
                            </div>
                            <div class="trust-item">
                                <strong>Assessment Method:</strong> Machine-readable validation with automated KSI assessment
                            </div>
                            <div class="trust-item">
                                <strong>Hosting Environment:</strong> AWS Commercial (US-East)
                            </div>
                            <div class="trust-item">
                                <strong>Evidence Repository:</strong> <a href="https://github.com/fedrampgyrus/fedramp_20x_public_submission_live" target="_blank" class="trust-link">GitHub Public Repo</a>
                            </div>
                            <div class="trust-item">
                                <strong>Validation Data:</strong> 
                                <a href="#" onclick="downloadJSON()" class="trust-link">üìÑ Download JSON</a> | 
                                <a href="#" onclick="viewFailedReport()" class="trust-link">üìã Failed KSI Report</a>
                            </div>
                        </div>
                    </div>

                    <!-- Available Materials -->
                    <div class="trust-card">
                        <div class="trust-card-header">
                            <h3 class="trust-card-title">üìã Available Materials</h3>
                        </div>
                        <div class="trust-card-content">
                            <div class="materials-section">
                                <div class="materials-header">üîí Public Materials:</div>
                                <ul class="materials-list">
                                    <li>Real-time compliance dashboard</li>
                                    <li>KSI validation methodology</li>
                                    <li>Service architecture overview</li>
                                    <li>Continuous monitoring reports</li>
                                </ul>
                            </div>
                            <div class="materials-section">
                                <div class="materials-header">üîê Federal Agency Access:</div>
                                <ul class="materials-list">
                                    <li>Complete authorization package</li>
                                    <li>Detailed security plans</li>
                                    <li>3PAO assessment reports</li>
                                    <li>Continuous monitoring data</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Three-Tier POA&M Innovation -->
                    <div class="trust-card enhancement-indicator">
                        <div class="trust-card-header" style="background: var(--gradient-enhancement);">
                            <h3 class="trust-card-title"> POA&M System</h3>
                        </div>
                        <div class="trust-card-content">
                            <div class="trust-item">
                                <strong>üö® Tier 1: Compliance POA&M</strong> - Traditional remediation for failed validations (30-90 day SLAs)
                            </div>
                            <div class="trust-item">
                                <strong>üìà Tier 2: Enhancement Tracking</strong> - Proactive improvement opportunities in passing KSIs (180-day cycles)
                            </div>
                            <div class="trust-item">
                                <strong>üïí Tier 3: Staleness Tracking</strong> - Evidence currency management (90-day refresh windows)
                            </div>
                            <div class="trust-item">
                                <strong>Innovation:</strong> First FedRAMP 20x submission to implement proactive enhancement tracking beyond traditional compliance gaps
                            </div>
                            <div class="trust-item">
                                <button onclick="window.showPOAMModal()" class="action-btn enhancement">üìä View Three-Tier Analysis</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KSI Details Section -->
            <div class="ksi-section">
                <div class="ksi-header">
                    <h2 class="ksi-title">
                        üîç Key Security Indicators
                    </h2>
                    <div class="filters">
                        <div class="filter-group">
                            <label for="status-filter" class="sr-only">Filter by status</label>
                            <select id="status-filter" class="filter-select">
                                <option value="">All Status</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="warning">Warning</option>
                                <option value="enhancement">Enhancement</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="category-filter" class="sr-only">Filter by category</label>
                            <select id="category-filter" class="filter-select">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="search-input" class="sr-only">Search KSIs</label>
                            <input type="text" id="search-input" class="search-box" placeholder="Search KSIs...">
                        </div>
                    </div>
                </div>

                <!-- Enhanced Filter Chips -->
                <div class="filter-chips" id="filter-chips">
                    <div class="filter-chip active" data-status="">All</div>
                    <div class="filter-chip" data-status="passed">‚úÖ Passed</div>
                    <div class="filter-chip" data-status="failed">‚ùå Failed</div>
                    <div class="filter-chip" data-status="warning">‚ö†Ô∏è Warning</div>
                    <div class="filter-chip" data-status="enhancement">üìà Enhancement</div>
                </div>

                <!-- KSI Grid -->
                <div class="ksi-grid" id="ksi-grid">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        Loading KSI data...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab 2 - Trust Center RFC-0011 -->
    <div id="trust-center-tab" class="tab-content">
        <div class="trust-center-container">
            <!-- Trust Center Header -->
            <div class="trust-center-header">
                <h1>üõ°Ô∏è RFC-0011 Compliant Trust Center</h1>
                <p class="trust-center-subtitle">Federal agency access to authorization data</p>
                <div class="compliance-badge-large">
                    API Access ‚Ä¢ Structured POA&M ‚Ä¢ Incident Reporting ‚Ä¢ Agency Workflow
                </div>
            </div>

            <!-- Quick Access Cards -->
            <div class="quick-access-grid">
                <div class="access-card">
                    <div class="card-icon">üîß</div>
                    <h3>API Access</h3>
                    <p>Machine-readable authorization data</p>
                    <button onclick="scrollToTrustSection('api-section')" class="access-btn">View API Docs</button>
                </div>
                
                <div class="access-card">
                    <div class="card-icon">üìã</div>
                    <h3>Request Access</h3>
                    <p>Federal agency request workflow</p>
                    <button onclick="scrollToTrustSection('agency-form-section')" class="access-btn">Submit Request</button>
                </div>
                
                <div class="access-card enhancement-indicator">
                    <div class="card-icon">üìä</div>
                    <h3>Three-Tier POA&M</h3>
                    <p>Revolutionary improvement tracking</p>
                    <button onclick="window.showPOAMModal()" class="access-btn">View POA&M</button>
                </div>
                
                <div class="access-card">
                    <div class="card-icon">üö®</div>
                    <h3>Incident Reports</h3>
                    <p>Security incident templates</p>
                    <button onclick="scrollToTrustSection('incident-section')" class="access-btn">Get Templates</button>
                </div>
            </div>

            <!-- API Section -->
            <div id="api-section" class="trust-section">
                <h2>üîß API Access (RFC-0011)</h2>
                <p>Programmatic access to real-time authorization data for federal agencies</p>
                
                <h4>Available Endpoints:</h4>
                <div style="background: var(--bg-accent); color: var(--text-primary); padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid var(--border-color);">
                    <div style="margin-bottom: 10px;"><strong>GET</strong> ./unified_ksi_validations.json - Complete KSI validation results</div>
                    <div style="margin-bottom: 10px;"><strong>GET</strong> ./failed_ksi_report_readable.md - Human-readable remediation guidance</div>
                    <div><strong>GET</strong> ./evidence_commit_metadata.json - Audit trail and evidence metadata</div>
                </div>
                
                <h4>Usage Example:</h4>
                <pre style="background: var(--bg-accent); color: var(--text-primary); padding: 15px; border-radius: 5px; overflow-x: auto; border: 1px solid var(--border-color);">
// Fetch current compliance status
async function getAuthorizationSummary() {
    const base = 'https://fedrampgyrus.github.io/fedramp_20x_public_submission_live';
    const response = await fetch(`${base}/unified_ksi_validations.json`);
    const data = await response.json();
    
    return {
        total_ksis: data.length,
        passed: data.filter(ksi => ksi.assertion === true).length,
        compliance_percentage: (data.filter(ksi => ksi.assertion === true).length / data.length * 100).toFixed(1)
    };
}
                </pre>
            </div>

            <!-- Agency Form Section -->
            <div id="agency-form-section" class="trust-section">
                <h2>üìã Federal Agency Access Request</h2>
                <p>Official process for federal agencies to request access to authorization materials</p>
                
                <form id="federal-access-form" style="max-width: 600px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Federal Agency *</label>
                            <input type="text" name="agency" required style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Authorizing Official *</label>
                            <input type="text" name="ao_name" required style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Official Email (.gov/.mil) *</label>
                        <input type="email" name="email" required style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Access Type *</label>
                        <select name="access_type" required style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                            <option value="">Select access type...</option>
                            <option value="full_package">Complete Authorization Package</option>
                            <option value="api_credentials">API Access Credentials</option>
                            <option value="monitoring_data">Continuous Monitoring Reports</option>
                            <option value="poam_access">Three-Tier POA&M Analysis</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Business Justification *</label>
                        <textarea name="justification" required rows="4" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: flex-start; color: var(--text-primary);">
                            <input type="checkbox" name="certification" required style="margin-right: 10px; margin-top: 3px;">
                            I certify that I am an authorized federal government representative.
                        </label>
                    </div>
                    
                    <button type="submit" style="background: var(--gradient-accent); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: 600; cursor: pointer; box-shadow: var(--shadow-sm);">
                        Submit Federal Access Request
                    </button>
                </form>
                
                <div id="form-response" style="margin-top: 20px;"></div>
            </div>

            <!-- Incident Section -->
            <div id="incident-section" class="trust-section">
                <h2>üö® Security Incident Reporting</h2>
                <p>FedRAMP-compliant incident classification, reporting templates, and notification procedures</p>
                
                <div style="background: rgba(245, 158, 11, 0.1); border: 2px solid var(--warning-500); border-radius: 10px; padding: 25px; margin-bottom: 30px; color: var(--text-primary);">
                    <h4 style="color: var(--warning-600); margin-bottom: 15px;">üö® Emergency Security Hotline</h4>
                    <div><strong>Phone:</strong> +1 (804) 320 -1414 </div>
                    <div><strong>Email:</strong> security@gyrus.com</div>
                    <div><strong>Response SLA:</strong> 1 hour for Category 1-2 incidents</div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: var(--bg-accent); padding: 25px; border-radius: 10px; border-left: 4px solid var(--danger-500); border: 1px solid var(--border-color);">
                        <h4 style="color: var(--text-primary);">üìã Incident Report Template</h4>
                        <p style="color: var(--text-secondary);">Standardized FedRAMP incident reporting format</p>
                        <button onclick="downloadIncidentTemplate()" style="background: var(--danger-500); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; box-shadow: var(--shadow-sm);">Download Template</button>
                    </div>
                    
                    <div style="background: var(--bg-accent); padding: 25px; border-radius: 10px; border-left: 4px solid var(--danger-500); border: 1px solid var(--border-color);">
                        <h4 style="color: var(--text-primary);">üìä Classification Guide</h4>
                        <p style="color: var(--text-secondary);">FedRAMP Categories 1-5 with notification timelines</p>
                        <button onclick="downloadClassificationGuide()" style="background: var(--danger-500); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; box-shadow: var(--shadow-sm);">Download Guide</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Modals -->
    <div class="cli-modal" id="cli-modal">
        <div class="cli-modal-content">
            <div class="cli-modal-header">
                <h3 class="cli-modal-title" id="modal-title">CLI Details</h3>
                <button class="close-btn" onclick="closeCliModal()">&times;</button>
            </div>
            <div class="cli-content" id="modal-content">
                <!-- CLI content will be inserted here -->
            </div>
        </div>
    </div>

    <div class="why-modal" id="why-modal">
        <div class="why-modal-content">
            <div class="why-modal-header">
                <h3 class="why-modal-title" id="why-modal-title">ü§î Why This Result?</h3>
                <button class="close-btn" onclick="closeWhyModal()">&times;</button>
            </div>
            <div class="why-modal-body" id="why-modal-body">
                <!-- Why content will be inserted here -->
            </div>
        </div>
    </div>

    <div class="markdown-modal" id="markdown-modal">
        <div class="markdown-modal-content">
            <div class="markdown-modal-header">
                <h3 class="markdown-modal-title">Failed KSI Report</h3>
                <button class="close-btn" onclick="closeMarkdownModal()">&times;</button>
            </div>
            <div class="markdown-modal-body" id="markdown-modal-body">
                <!-- Markdown content will be inserted here -->
            </div>
        </div>
    </div>

    <div class="commands-modal" id="commands-modal">
        <div class="commands-modal-content">
            <div class="commands-modal-header">
                <h3 class="commands-modal-title" id="commands-modal-title">‚ö° Commands Executed</h3>
                <button class="close-btn" onclick="closeCommandsModal()">&times;</button>
            </div>
            <div class="commands-modal-body" id="commands-modal-body">
                <!-- Commands content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- NEW: Three-Tier POA&M Modal -->
    <div class="poam-modal" id="poam-modal">
        <div class="poam-modal-content">
            <div class="poam-modal-header">
                <h3 class="poam-modal-title" id="poam-modal-title">üöÄ Three-Tier POA&M Analysis</h3>
                <button class="close-btn" onclick="closePOAMModal()">&times;</button>
            </div>
            <div class="poam-modal-body" id="poam-modal-body">
                <!-- Three-tier POA&M content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- NEW: Enhancement Details Modal -->
<div class="enhancement-modal" id="enhancement-modal">
    <div class="enhancement-modal-content">
        <div class="enhancement-modal-header">
            <h3 class="enhancement-modal-title" id="enhancement-modal-title">üìà Enhancement Opportunity Details</h3>
            <button class="close-btn" onclick="closeEnhancementModal()">&times;</button>
        </div>
        <div class="enhancement-modal-body" id="enhancement-modal-body">
            <!-- Enhancement details will be inserted here -->
        </div>
    </div>
</div>

    <!-- NEW: Enhancement Details Modal -->
    <div class="enhancement-modal" id="enhancement-modal">
        <div class="enhancement-modal-content">
            <div class="enhancement-modal-header">
                <h3 class="enhancement-modal-title">üìà Enhancement Opportunity Details</h3>
                <button class="close-btn" onclick="closeEnhancementModal()">&times;</button>
            </div>
            <div class="enhancement-modal-body" id="enhancement-modal-body">
                <!-- Enhancement details will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ GLOBAL VARIABLES: Enhanced for three-tier POA&M system
        let allKsis = [];
        let filteredKsis = [];
        let currentFilters = { status: '', category: '', search: '' };
        let commandRegister = null; // Store the comprehensive command register
        let threeTierPOAM = {
            compliance: [],
            enhancement: [],
            staleness: []
        };

        // ‚úÖ ENHANCED: Load comprehensive command register
        async function loadCommandRegister() {
            try {
                console.log('üìã Attempting to load comprehensive command register...');
                const response = await fetch('./cli_command_register.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const register = await response.json();
                console.log('‚úÖ Command register loaded successfully');
                console.log(`üìä Register contains ${Object.keys(register).length} KSIs with detailed commands`);
                
                commandRegister = register;
                return register;
            } catch (error) {
                console.warn('‚ö†Ô∏è Could not load command register:', error.message);
                commandRegister = null;
                return null;
            }
        }

        // ‚úÖ ENHANCED: Extract command details with comprehensive register support
        function extractCommandDetails(validation) {
            const ksiId = validation.ksi_id || validation.validation_id || 'Unknown';
            
            // ‚úÖ PRIORITY 1: Use comprehensive command register if available
            if (commandRegister && commandRegister[ksiId]) {
                const registerEntry = commandRegister[ksiId];
                console.log(`üéØ Using comprehensive register for ${ksiId}: ${registerEntry.cli_commands?.length || 0} commands`);
                
                return {
                    commands: registerEntry.cli_commands?.map((cmd, index) => ({
                        command: cmd.command || cmd,
                        description: cmd.note || `Command ${index + 1}`,
                        status: determineCommandStatus(validation, index),
                        execution_time: 'Unknown',
                        source: 'comprehensive_register'
                    })) || [],
                    source: 'comprehensive_register',
                    description: registerEntry.description,
                    justification: registerEntry.justification
                };
            }
            
            // ‚úÖ FALLBACK 1: Parse validation summary format
            if (validation.cli_command) {
                console.log(`üìù Using fallback parsing for ${ksiId}`);
                return {
                    commands: parseCliCommandString(validation),
                    source: 'validation_summary'
                };
            }
            
            // ‚úÖ FALLBACK 2: No command data available
            console.log(`‚ùå No command data available for ${ksiId}`);
            return {
                commands: [],
                source: 'no_data'
            };
        }

        // ‚úÖ HELPER: Determine command status based on validation results
        function determineCommandStatus(validation, commandIndex) {
            const successfulCommands = validation.successful_commands || 0;
            const failedCommands = validation.failed_commands || 0;
            const totalCommands = validation.commands_executed || 0;
            
            if (failedCommands === 0) return 'success';
            if (successfulCommands === 0) return 'failed';
            
            // Mixed results - distribute based on success rate
            return commandIndex < successfulCommands ? 'success' : 'failed';
        }

        // ‚úÖ ENHANCED: Parse CLI command string (fallback method)
        function parseCliCommandString(validation) {
            const cliCommand = validation.cli_command;
            const totalCommands = validation.commands_executed || 0;
            
            const commandMatch = cliCommand.match(/^(\d+)\s+commands?\s+\((\d+)\s+successful\):\s*(.+)$/);
            
            if (!commandMatch) {
                return [{
                    command: cliCommand,
                    description: 'Primary validation command',
                    status: validation.assertion === true ? 'success' : 'failed',
                    execution_time: 'Unknown',
                    source: 'fallback_single'
                }];
            }
            
            const [, totalStr, successfulStr, commandsStr] = commandMatch;
            const successful = parseInt(successfulStr);
            
            let commandsList = commandsStr.split(';').map(cmd => cmd.trim());
            
            // Handle "(+X more)" truncation
            const lastCommand = commandsList[commandsList.length - 1];
            const moreMatch = lastCommand.match(/^(.+?)\s+\(\+(\d+)\s+more\)$/);
            
            if (moreMatch) {
                commandsList[commandsList.length - 1] = moreMatch[1].trim();
                const truncatedCount = parseInt(moreMatch[2]);
                
                for (let i = 0; i < truncatedCount; i++) {
                    commandsList.push('... additional command not shown ...');
                }
            }
            
            return commandsList.map((cmd, index) => ({
                command: cmd,
                description: generateCommandDescription(cmd, index + 1),
                status: index < successful ? 'success' : 'failed',
                execution_time: 'Unknown',
                source: 'fallback_parsed'
            }));
        }

        function generateCommandDescription(command, index) {
            const cmd = command.toLowerCase();
            
            if (cmd.includes('describe-security-groups')) return 'Check security group configurations';
            if (cmd.includes('describe-network-acls')) return 'Analyze Network ACL configurations';
            if (cmd.includes('describe-route-tables')) return 'Validate routing configurations';
            if (cmd.includes('describe-nat-gateways')) return 'Check NAT Gateway configurations';
            if (cmd.includes('describe-vpc-endpoints')) return 'Validate VPC endpoints';
            if (cmd.includes('list-web-acls')) return 'Check WAF configurations';
            if (cmd.includes('describe-load-balancers')) return 'Analyze load balancers';
            if (cmd.includes('describe-log-groups')) return 'Check log configurations';
            if (cmd.includes('describe-trails')) return 'Analyze CloudTrail configuration';
            if (cmd.includes('list-users')) return 'List IAM users';
            if (cmd.includes('get-account-summary')) return 'Get account-wide IAM statistics';
            if (cmd.includes('describe-instances')) return 'Analyze EC2 instances';
            if (cmd.includes('describe-subnets')) return 'Examine subnet configurations';
            if (cmd.includes('describe-vpcs')) return 'Check VPC configurations';
            
            return `Command ${index}: ${command.split(' ')[1] || 'AWS operation'}`;
        }

        // ‚úÖ ENHANCED: Smart Partial Detection Engine
        function detectEnhancementOpportunities(assertionReason, ksiStatus) {
            if (ksiStatus !== 'passed') return [];
            
            const opportunities = [];
            const reason = assertionReason || '';
            
            // Pattern detection for enhancement opportunities
            const patterns = [
                {
                    pattern: /basic\s+(\w+)/gi,
                    type: 'Basic Implementation',
                    description: 'Consider upgrading from basic to advanced configuration'
                },
                {
                    pattern: /minimal\s+(\w+)/gi,
                    type: 'Minimal Configuration',
                    description: 'Opportunity to enhance beyond minimum requirements'
                },
                {
                    pattern: /single\s+(\w+)/gi,
                    type: 'Single Point Configuration',
                    description: 'Consider implementing redundancy or multi-point architecture'
                },
                {
                    pattern: /limited\s+(\w+)/gi,
                    type: 'Limited Scope',
                    description: 'Opportunity to expand coverage or capabilities'
                },
                {
                    pattern: /(\d+)%.*partial/gi,
                    type: 'Partial Implementation',
                    description: 'Identified areas for completion or enhancement'
                },
                {
                    pattern: /(high|significant|substantial).*exposure/gi,
                    type: 'Exposure Risk',
                    description: 'Opportunity to reduce risk exposure through enhanced controls'
                },
                {
                    pattern: /segmentation.*detected/gi,
                    type: 'Segmentation Enhancement',
                    description: 'Network segmentation can be enhanced for better isolation'
                }
            ];
            
            patterns.forEach(({ pattern, type, description }) => {
                const matches = reason.match(pattern);
                if (matches) {
                    opportunities.push({
                        type,
                        description,
                        evidence: matches[0],
                        priority: calculateEnhancementPriority(type, matches[0])
                    });
                }
            });
            
            return opportunities;
        }

        function calculateEnhancementPriority(type, evidence) {
            const priorityMap = {
                'Exposure Risk': 'High',
                'Segmentation Enhancement': 'High', 
                'Single Point Configuration': 'Medium',
                'Basic Implementation': 'Medium',
                'Partial Implementation': 'Medium',
                'Minimal Configuration': 'Low',
                'Limited Scope': 'Low'
            };
            
            return priorityMap[type] || 'Low';
        }

        // ‚úÖ ENHANCED: Generate comprehensive three-tier POA&M entries
        function generateThreeTierPOAM(ksis) {
            const poam = {
                compliance: [],
                enhancement: [],
                staleness: []
            };
            
            let entryCounter = 1;
            
            ksis.forEach(ksi => {
                const now = new Date();
                const validationDate = ksi.timestamp ? new Date(ksi.timestamp) : null;
                const daysSinceValidation = validationDate ? Math.floor((now - validationDate) / (1000 * 60 * 60 * 24)) : null;
                const isStale = daysSinceValidation && daysSinceValidation > 30;
                
                // üö® TIER 1: Compliance POA&M (Failed KSIs)
                if (ksi.status === 'failed') {
                    const severity = getCriticalityTier(ksi);
                    const responseTime = getResponseTimeForSeverity(severity);
                    const targetDate = new Date();
                    targetDate.setDate(targetDate.getDate() + responseTime);
                    
                    poam.compliance.push({
                        id: `COMP-${String(entryCounter++).padStart(3, '0')}`,
                        ksiId: ksi.id,
                        tier: 'Compliance',
                        category: ksi.category,
                        severity,
                        description: `Failed validation: ${ksi.description}`,
                        status: 'Open',
                        targetDate: targetDate.toISOString().split('T')[0],
                        daysOverdue: Math.max(0, (daysSinceValidation || 0) - responseTime),
                        assertionReason: ksi.assertion_reason,
                        responseTime,
                        evidenceAge: daysSinceValidation,
                        actionPlan: generateComplianceActionPlan(ksi),
                        businessImpact: assessBusinessImpact(ksi, 'failed')
                    });
                }
                
                // üìà TIER 2: Enhancement Tracking (Passing KSIs with improvement opportunities)
                if (ksi.status === 'passed') {
                    const enhancements = detectEnhancementOpportunities(ksi.assertion_reason, ksi.status);
                    
                    if (enhancements.length > 0) {
                        ksi.hasEnhancements = true;
                        ksi.enhancements = enhancements;
                        
                        const targetDate = new Date();
                        targetDate.setDate(targetDate.getDate() + 180); // 180-day enhancement cycle
                        
                        poam.enhancement.push({
                            id: `ENH-${String(entryCounter++).padStart(3, '0')}`,
                            ksiId: ksi.id,
                            tier: 'Enhancement',
                            category: ksi.category,
                            priority: enhancements[0].priority,
                            description: `Enhancement opportunity: ${ksi.description}`,
                            status: 'Identified',
                            targetDate: targetDate.toISOString().split('T')[0],
                            opportunities: enhancements,
                            assertionReason: ksi.assertion_reason,
                            improvementCycle: 180,
                            evidenceAge: daysSinceValidation,
                            actionPlan: generateEnhancementActionPlan(ksi, enhancements),
                            businessValue: assessBusinessValue(ksi, enhancements)
                        });
                    }
                }
                
                // üïí TIER 3: Staleness Tracking (Evidence currency management)
                if (isStale) {
                    const targetDate = new Date();
                    targetDate.setDate(targetDate.getDate() + 90); // 90-day refresh window
                    
                    poam.staleness.push({
                        id: `STAL-${String(entryCounter++).padStart(3, '0')}`,
                        ksiId: ksi.id,
                        tier: 'Staleness',
                        category: ksi.category,
                        priority: 'Medium',
                        description: `Evidence validation required (${daysSinceValidation} days old): ${ksi.description}`,
                        status: daysSinceValidation > 90 ? 'Overdue' : 'Due Soon',
                        targetDate: targetDate.toISOString().split('T')[0],
                        daysOverdue: Math.max(0, daysSinceValidation - 90),
                        assertionReason: ksi.assertion_reason,
                        refreshWindow: 90,
                        evidenceAge: daysSinceValidation,
                        actionPlan: generateStalenessActionPlan(ksi, daysSinceValidation),
                        riskLevel: assessStalenessRisk(daysSinceValidation)
                    });
                }
            });
            
            threeTierPOAM = poam;
            return poam;
        }

        function generateComplianceActionPlan(ksi) {
            const plans = {
                'Access Control': 'Review and remediate access control configurations, validate user permissions and role assignments',
                'Audit Logging': 'Configure comprehensive logging, establish retention policies, implement centralized log management',
                'Encryption': 'Implement encryption controls, validate key management practices, ensure data protection at rest and in transit',
                'Network Security': 'Review network segmentation, validate firewall rules, implement traffic monitoring',
                'Service Configuration': 'Audit service settings, apply security hardening, validate configuration baselines'
            };
            
            const category = ksi.category || 'General';
            return plans[category] || 'Review KSI requirements, identify gaps, implement necessary controls, validate remediation';
        }

        function generateEnhancementActionPlan(ksi, opportunities) {
            const baseActions = [
                'Assess current implementation against industry best practices',
                'Evaluate cost-benefit of enhancement opportunities',
                'Develop enhancement roadmap with priority sequencing',
                'Implement proof-of-concept for high-value improvements'
            ];
            
            const specificActions = opportunities.map(opp => 
                `Address ${opp.type.toLowerCase()}: ${opp.description}`
            );
            
            return [...baseActions, ...specificActions].join('; ');
        }

        function generateStalenessActionPlan(ksi, daysOld) {
            const urgency = daysOld > 90 ? 'immediate' : daysOld > 60 ? 'priority' : 'routine';
            const actions = [
                `Schedule ${urgency} evidence re-validation for ${ksi.id}`,
                'Execute updated validation commands and collect fresh evidence',
                'Review and update validation methodology if needed',
                'Document evidence collection and validation results'
            ];
            
            if (daysOld > 120) {
                actions.unshift('URGENT: Evidence significantly stale, prioritize immediate validation');
            }
            
            return actions.join('; ');
        }

        function assessBusinessImpact(ksi, status) {
            const impacts = {
                'Access Control': 'High - Unauthorized access risk to federal data',
                'Audit Logging': 'High - Compliance monitoring and incident response capabilities',
                'Encryption': 'Critical - Data protection and regulatory compliance',
                'Network Security': 'High - Network attack surface and lateral movement risk',
                'Service Configuration': 'Medium - Service availability and security posture'
            };
            
            return impacts[ksi.category] || 'Medium - General security posture impact';
        }

        function assessBusinessValue(ksi, opportunities) {
            const highValueIndicators = ['Exposure Risk', 'Segmentation Enhancement', 'Single Point Configuration'];
            const hasHighValue = opportunities.some(opp => highValueIndicators.includes(opp.type));
            
            if (hasHighValue) {
                return 'High - Proactive risk reduction and enhanced security posture';
            }
            
            return 'Medium - Operational efficiency and security maturity improvements';
        }

        function assessStalenessRisk(daysOld) {
            if (daysOld > 120) return 'High - Evidence significantly outdated';
            if (daysOld > 90) return 'Medium - Evidence aging beyond policy';
            if (daysOld > 60) return 'Low - Evidence approaching refresh window';
            return 'Minimal - Evidence within acceptable range';
        }

        function getCriticalityTier(ksi) {
            const criticalCategories = ['Access Control', 'Audit Logging', 'Encryption'];
            const category = ksi.category || '';
            
            if (criticalCategories.some(cat => category.includes(cat))) {
                return 'High';
            }
            
            const reason = ksi.assertion_reason || '';
            if (reason.toLowerCase().includes('critical') || reason.toLowerCase().includes('security')) {
                return 'High';
            }
            
            return 'Medium';
        }

        function getResponseTimeForSeverity(severity) {
            const timelines = {
                'Critical': 30,
                'High': 60,
                'Medium': 90,
                'Low': 120
            };
            return timelines[severity] || 90;
        }

        // ‚úÖ ENHANCED: Show comprehensive three-tier POA&M modal
        function showPOAMModal() {
            const modalTitle = document.getElementById('poam-modal-title');
            const modalBody = document.getElementById('poam-modal-body');
            
            modalTitle.innerHTML = ' Three-Tier POA&M Analysis';
            
            const poam = generateThreeTierPOAM(allKsis);
            
            modalBody.innerHTML = `
                <!-- POA&M Overview -->
                <div class="poam-summary">
                    <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; color: var(--text-primary);">
                        üìä Three-Tier POA&M Overview
                    </h4>
                    <div class="poam-stats">
                        <div class="poam-stat">
                            <div class="poam-stat-value">${poam.compliance.length}</div>
                            <div class="poam-stat-label">Compliance</div>
                        </div>
                        <div class="poam-stat">
                            <div class="poam-stat-value">${poam.enhancement.length}</div>
                            <div class="poam-stat-label">Enhancement</div>
                        </div>
                        <div class="poam-stat">
                            <div class="poam-stat-value">${poam.staleness.length}</div>
                            <div class="poam-stat-label">Staleness</div>
                        </div>
                        <div class="poam-stat">
                            <div class="poam-stat-value">${poam.compliance.length + poam.enhancement.length + poam.staleness.length}</div>
                            <div class="poam-stat-label">Total Items</div>
                        </div>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid var(--enhancement-500); border-radius: 8px; padding: 1rem; margin-top: 1rem;">
                        <strong style="color: var(--enhancement-600);">üöÄ Innovation Highlight:</strong> 
                        <span style="color: var(--text-primary);">First FedRAMP 20x submission to implement proactive enhancement tracking beyond traditional compliance gaps, demonstrating continuous improvement culture.</span>
                    </div>
                </div>

                <!-- Tier Selector -->
                <div class="poam-tier-selector">
                    <button class="tier-btn active" onclick="showPOAMTier('compliance')">
                        üö® Tier 1: Compliance POA&M
                        <div style="font-size: 0.8rem; margin-top: 0.25rem; opacity: 0.8;">${poam.compliance.length} items</div>
                    </button>
                    <button class="tier-btn" onclick="showPOAMTier('enhancement')">
                        üìà Tier 2: Enhancement Tracking
                        <div style="font-size: 0.8rem; margin-top: 0.25rem; opacity: 0.8;">${poam.enhancement.length} items</div>
                    </button>
                    <button class="tier-btn" onclick="showPOAMTier('staleness')">
                        üïí Tier 3: Staleness Tracking
                        <div style="font-size: 0.8rem; margin-top: 0.25rem; opacity: 0.8;">${poam.staleness.length} items</div>
                    </button>
                </div>

                <!-- Tier Content Sections -->
                <div id="tier-compliance" class="tier-content active">
                    ${generateTierContent(poam.compliance, 'compliance')}
                </div>
                
                <div id="tier-enhancement" class="tier-content">
                    ${generateTierContent(poam.enhancement, 'enhancement')}
                </div>
                
                <div id="tier-staleness" class="tier-content">
                    ${generateTierContent(poam.staleness, 'staleness')}
                </div>
            `;

            document.getElementById('poam-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function generateTierContent(items, tierType) {
            const tierInfo = {
                compliance: {
                    icon: 'üö®',
                    title: 'Compliance POA&M - Traditional Remediation',
                    description: 'Failed validations requiring immediate remediation with 30-90 day SLAs',
                    emptyMessage: 'No compliance gaps detected - all KSIs passing validation'
                },
                enhancement: {
                    icon: 'üìà',
                    title: 'Enhancement Tracking - Proactive Improvement',
                    description: 'Passing KSIs with identified improvement opportunities on 180-day cycles',
                    emptyMessage: 'No enhancement opportunities detected - all implementations at optimal level'
                },
                staleness: {
                    icon: 'üïí',
                    title: 'Staleness Tracking - Evidence Currency',
                    description: 'Evidence aging beyond 30-day freshness window requiring re-validation',
                    emptyMessage: 'All evidence current - no stale validations detected'
                }
            };

            const info = tierInfo[tierType];
            
            if (items.length === 0) {
                return `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">${info.icon}</div>
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem;">${info.title}</h3>
                        <p style="margin-bottom: 1rem;">${info.description}</p>
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid var(--success-500); border-radius: 8px; padding: 1rem; color: var(--success-600);">
                            <strong>‚úÖ ${info.emptyMessage}</strong>
                        </div>
                    </div>
                `;
            }

            return `
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        ${info.icon} ${info.title}
                    </h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">${info.description}</p>
                </div>
                
                <div class="poam-list">
                    ${items.map((item, index) => `
                        <div class="poam-item">
                            <div class="poam-header" onclick="togglePOAMDetails(${index}, '${tierType}')">
                                <div class="poam-title">
                                    <span class="tier-indicator tier-${tierType}">${item.tier}</span>
                                    <span>${item.id}: ${item.ksiId}</span>
                                </div>
                                <button class="poam-expand-btn" id="poam-expand-${tierType}-${index}">‚ñº</button>
                            </div>
                            <div class="poam-details" id="poam-details-${tierType}-${index}">
                                <div class="poam-info">
                                    <strong style="color: var(--text-primary);">Description:</strong>
                                    <p style="margin: 0.5rem 0; color: var(--text-secondary);">${item.description}</p>
                                    
                                    <strong style="color: var(--text-primary);">Action Plan:</strong>
                                    <p style="margin: 0.5rem 0; color: var(--text-secondary);">${item.actionPlan}</p>
                                    
                                    ${item.opportunities ? `
                                        <strong style="color: var(--text-primary);">Enhancement Opportunities:</strong>
                                        ${item.opportunities.map(opp => `
                                            <div class="enhancement-opportunity">
                                                <div class="title">${opp.type} (${opp.priority} Priority)</div>
                                                <div class="description">${opp.description}</div>
                                                <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 0.25rem;">Evidence: ${opp.evidence}</div>
                                            </div>
                                        `).join('')}
                                    ` : ''}
                                    
                                    <strong style="color: var(--text-primary);">Assessment Details:</strong>
                                    <div style="background: var(--bg-accent); padding: 0.75rem; border-radius: 4px; margin: 0.5rem 0; font-size: 0.875rem; color: var(--text-secondary);">
                                        ${item.assertionReason}
                                    </div>
                                </div>
                                
                                <div class="poam-meta">
                                    <div class="poam-meta-item">
                                        <div class="poam-meta-value">${item.priority || item.severity}</div>
                                        <div class="poam-meta-label">Priority</div>
                                    </div>
                                    <div class="poam-meta-item">
                                        <div class="poam-meta-value">${item.status}</div>
                                        <div class="poam-meta-label">Status</div>
                                    </div>
                                    <div class="poam-meta-item">
                                        <div class="poam-meta-value">${item.targetDate}</div>
                                        <div class="poam-meta-label">Target</div>
                                    </div>
                                    <div class="poam-meta-item">
                                        <div class="poam-meta-value">${item.evidenceAge || 'Current'}</div>
                                        <div class="poam-meta-label">Age (days)</div>
                                    </div>
                                </div>
                                
                                ${tierType === 'enhancement' ? `
                                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                                        <button onclick="showEnhancementModal('${item.ksiId}')" class="action-btn enhancement">
                                            üìà View Enhancement Plan
                                        </button>
                                        <button onclick="downloadEnhancementTemplate('${item.id}')" class="action-btn secondary">
                                            üìÑ Download Template
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showPOAMTier(tierName) {
            // Update tier buttons
            document.querySelectorAll('.tier-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tier content
            document.querySelectorAll('.tier-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tier-${tierName}`).classList.add('active');
        }

        function togglePOAMDetails(index, tierType) {
            const details = document.getElementById(`poam-details-${tierType}-${index}`);
            const button = document.getElementById(`poam-expand-${tierType}-${index}`);
            
            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                button.classList.remove('expanded');
            } else {
                details.classList.add('expanded');
                button.classList.add('expanded');
            }
        }

        function closePOAMModal() {
            document.getElementById('poam-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ‚úÖ ENHANCED: Show Enhancement Modal with detailed improvement planning
        function showEnhancementModal(ksiId) {
            const ksi = allKsis.find(k => k.id === ksiId);
            if (!ksi || !ksi.hasEnhancements) return;

            const modalTitle = document.getElementById('enhancement-modal-title');
            const modalBody = document.getElementById('enhancement-modal-body');

            modalTitle.innerHTML = `üìà Enhancement Plan: ${ksi.id}`;

            modalBody.innerHTML = `
                <div style="background: var(--bg-accent); border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        üéØ Enhancement Overview
                    </h4>
                    <div style="margin-bottom: 1rem;">
                        <strong style="color: var(--text-primary);">KSI:</strong> ${ksi.description}
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong style="color: var(--text-primary);">Current Status:</strong> 
                        <span style="color: var(--success-500);">‚úÖ Passed</span> (meets compliance requirements)
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong style="color: var(--text-primary);">Enhancement Cycle:</strong> 180 days
                    </div>
                    <div>
                        <strong style="color: var(--text-primary);">Business Value:</strong> Proactive risk reduction and security maturity advancement
                    </div>
                </div>

                <h4 style="color: var(--text-primary); margin-bottom: 1rem;">üîç Identified Opportunities</h4>
                ${ksi.enhancements.map((enhancement, index) => `
                    <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 1.25rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem;">
                            <h5 style="color: var(--enhancement-600); margin: 0;">${enhancement.type}</h5>
                            <span style="background: ${enhancement.priority === 'High' ? 'var(--danger-500)' : enhancement.priority === 'Medium' ? 'var(--warning-500)' : 'var(--info-500)'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                                ${enhancement.priority} Priority
                            </span>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 0.75rem;">${enhancement.description}</p>
                        <div style="background: var(--bg-accent); padding: 0.75rem; border-radius: 4px; font-size: 0.875rem;">
                            <strong style="color: var(--text-primary);">Evidence:</strong> 
                            <span style="color: var(--text-secondary);">${enhancement.evidence}</span>
                        </div>
                    </div>
                `).join('')}

                <div style="background: var(--bg-accent); border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem; margin-top: 2rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 1rem;">üìã Recommended Action Plan</h4>
                    <ol style="margin: 0; padding-left: 1.5rem; color: var(--text-secondary);">
                        <li style="margin-bottom: 0.5rem;">Assess current implementation against industry best practices</li>
                        <li style="margin-bottom: 0.5rem;">Evaluate cost-benefit of enhancement opportunities</li>
                        <li style="margin-bottom: 0.5rem;">Develop enhancement roadmap with priority sequencing</li>
                        <li style="margin-bottom: 0.5rem;">Implement proof-of-concept for high-value improvements</li>
                        ${ksi.enhancements.map(enh => `<li style="margin-bottom: 0.5rem;">Address ${enh.type.toLowerCase()}: ${enh.description}</li>`).join('')}
                    </ol>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center;">
                    <button onclick="downloadEnhancementTemplate('${ksi.id}')" class="action-btn enhancement">
                        üìÑ Download Enhancement Template
                    </button>
                    <button onclick="createEnhancementIssue('${ksi.id}')" class="action-btn secondary">
                        üêõ Create Tracking Issue
                    </button>
                </div>
            `;

            document.getElementById('enhancement-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeEnhancementModal() {
            document.getElementById('enhancement-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function downloadEnhancementTemplate(enhancementId) {
            const template = {
                enhancement_id: enhancementId,
                type: "Proactive Enhancement",
                cycle_duration: "180 days",
                opportunities: "List of identified improvement areas",
                action_plan: "Detailed enhancement roadmap",
                success_metrics: "KPIs to measure improvement",
                business_value: "Expected ROI and risk reduction",
                implementation_phases: ["Assessment", "Planning", "Development", "Validation"],
                status: "Identified"
            };
            
            const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `enhancement_template_${enhancementId}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function createEnhancementIssue(ksiId) {
            const ksi = allKsis.find(k => k.id === ksiId);
            if (!ksi) return;

            const issueTitle = encodeURIComponent(`[Enhancement Opportunity] ${ksi.id}: Proactive Security Improvements`);
            const enhancementList = ksi.enhancements.map(enh => `- **${enh.type}**: ${enh.description} (${enh.priority} Priority)`).join('\n');
            
            const issueBody = encodeURIComponent(`## Enhancement Opportunity Report

**KSI ID:** ${ksi.id}
**Category:** ${ksi.category}
**Current Status:** ‚úÖ PASSED (Compliant)
**Enhancement Type:** Proactive Improvement

### Current Implementation
${ksi.description}

### Assessment Result
${ksi.assertion_reason}

### Identified Enhancement Opportunities
${enhancementList}

### Business Value
- Proactive risk reduction
- Enhanced security posture
- Continuous improvement demonstration
- FedRAMP 20x innovation showcase

### Recommended Action Plan
1. Assess current implementation against industry best practices
2. Evaluate cost-benefit of enhancement opportunities  
3. Develop enhancement roadmap with priority sequencing
4. Implement proof-of-concept for high-value improvements

### Success Metrics
- [ ] Risk exposure reduction
- [ ] Security control maturity advancement
- [ ] Operational efficiency improvements
- [ ] Compliance posture strengthening

---
**Enhancement Cycle:** 180 days
**Priority:** Proactive Improvement
**Generated by:** Three-Tier POA&M System`);

            const githubUrl = `https://github.com/fedrampgyrus/fedramp_20x_public_submission_live/issues/new?title=${issueTitle}&body=${issueBody}&labels=enhancement-opportunity,tier-2,continuous-improvement`;
            window.open(githubUrl, '_blank');
        }

        // ‚úÖ ENHANCED: Initialize with sample data showcasing KSI-CNA-02
        function initializeSampleData() {
            allKsis = [
                {
                    id: 'KSI-CNA-01',
                    category: 'Cloud Native Architecture',
                    status: 'passed',
                    description: 'Configure ALL information resources to limit inbound and outbound traffic',
                    commands_executed: 8,
                    successful_commands: 8,
                    failed_commands: 0,
                    cli_command: '8 commands (8 successful): aws ec2 describe-security-groups; aws ec2 describe-network-acls; ...',
                    assertion_reason: '‚úÖ Comprehensive traffic controls configured across all AWS resources',
                    requirement: 'Multi-layered network security including ingress/egress controls',
                    detailed_commands: [
                        {
                            command: 'aws ec2 describe-security-groups --output json',
                            description: 'Analyze security groups for comprehensive ingress AND egress traffic controls',
                            status: 'success',
                            execution_time: '1.2s',
                            source: 'sample_data'
                        },
                        {
                            command: 'aws ec2 describe-network-acls --output json',
                            description: 'Check Network ACLs for subnet-level traffic filtering (defense in depth)',
                            status: 'success',
                            execution_time: '0.8s',
                            source: 'sample_data'
                        },
                        {
                            command: 'aws ec2 describe-route-tables --output json',
                            description: 'Validate route tables for controlled traffic routing and egress paths',
                            status: 'success',
                            execution_time: '0.9s',
                            source: 'sample_data'
                        },
                        {
                            command: 'aws ec2 describe-nat-gateways --output json',
                            description: 'Check NAT Gateways for controlled egress traffic from private subnets',
                            status: 'success',
                            execution_time: '0.7s',
                            source: 'sample_data'
                        },
                        {
                            command: 'aws ec2 describe-vpc-endpoints --output json',
                            description: 'Validate VPC endpoints for private service access (avoiding internet routing)',
                            status: 'success',
                            execution_time: '0.6s',
                            source: 'sample_data'
                        },
                        {
                            command: 'aws wafv2 list-web-acls --scope REGIONAL --output json',
                            description: 'Check WAF for application-layer traffic filtering and protection',
                            status: 'success',
                            execution_time: '1.0s',
                            source: 'sample_data'
                        },
                        {
                            command: 'aws elbv2 describe-load-balancers --output json',
                            description: 'Analyze load balancers for traffic distribution and access controls',
                            status: 'success',
                            execution_time: '0.8s',
                            source: 'sample_data'
                        },
                        {
                            command: 'aws logs describe-log-groups --log-group-name-prefix /aws/vpc/flowlogs --output json',
                            description: 'Verify VPC Flow Logs for traffic monitoring and visibility',
                            status: 'success',
                            execution_time: '0.5s',
                            source: 'sample_data'
                        }
                    ],
                    command_source: 'sample_comprehensive'
                },
                {
                    id: 'KSI-CNA-02',
                    category: 'Cloud Native Architecture', 
                    status: 'passed',
                    description: 'Implement comprehensive network segmentation with multi-AZ redundancy',
                    commands_executed: 12,
                    successful_commands: 10,
                    failed_commands: 2,
                    cli_command: '12 commands (10 successful): aws ec2 describe-availability-zones; aws ec2 describe-subnets; ...',
                    assertion_reason: '‚úÖ Network segmentation implemented (85%): ‚ö†Ô∏è Basic AZ segmentation detected across 2 zones; ‚ö†Ô∏è High service exposure identified in public subnets; ‚úÖ Private subnet isolation properly configured; ‚ö†Ô∏è Limited cross-AZ redundancy for critical services',
                    requirement: 'Multi-AZ network segmentation with comprehensive traffic isolation',
                    timestamp: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(), // 15 days ago
                    hasEnhancements: true,
                    enhancements: [
                        {
                            type: 'Basic Implementation',
                            description: 'Consider upgrading from basic to advanced AZ segmentation',
                            evidence: 'Basic AZ segmentation detected',
                            priority: 'Medium'
                        },
                        {
                            type: 'Exposure Risk',
                            description: 'Opportunity to reduce risk exposure through enhanced controls',
                            evidence: 'High service exposure identified',
                            priority: 'High'
                        }
                    ],
                    detailed_commands: [
                        {
                            command: 'aws ec2 describe-availability-zones --output json',
                            description: 'Validate availability zone configuration and distribution',
                            status: 'success',
                            execution_time: '0.5s',
                            source: 'sample_enhanced'
                        },
                        {
                            command: 'aws ec2 describe-subnets --output json',
                            description: 'Analyze subnet segmentation across availability zones',
                            status: 'success',
                            execution_time: '1.1s',
                            source: 'sample_enhanced'
                        },
                        {
                            command: 'aws ec2 describe-instances --query "Reservations[*].Instances[*].[InstanceId,SubnetId,SecurityGroups]"',
                            description: 'Check instance distribution and security group assignments',
                            status: 'failed',
                            execution_time: '2.3s',
                            source: 'sample_enhanced'
                        }
                    ],
                    command_source: 'sample_enhanced'
                },
                {
                    id: 'KSI-MLA-01',
                    category: 'Multi-layered Audit Logging',
                    status: 'passed',
                    description: 'Log, aggregate, monitor, analyze, and audit all security events',
                    commands_executed: 8,
                    successful_commands: 8,
                    failed_commands: 0,
                    cli_command: '8 commands (8 successful): aws cloudtrail describe-trails; aws logs describe-log-groups; ...',
                    assertion_reason: '‚úÖ Production-ready SIEM with advanced monitoring capabilities (69%): ‚úÖ CloudTrail foundation: 1 trails (0 active, 1 tamper-resistant); ‚úÖ Centralized log collection: 5 log groups',
                    requirement: 'Log, aggregate, monitor, analyze, and audit all security events',
                    detailed_commands: [
                        {
                            command: 'aws cloudtrail describe-trails --output json',
                            description: 'CloudTrail foundation established',
                            status: 'success',
                            execution_time: '1.2s',
                            source: 'sample_data'
                        },
                        {
                            command: 'aws logs describe-log-groups --output json',
                            description: 'Centralized log collection active',
                            status: 'success',
                            execution_time: '0.8s',
                            source: 'sample_data'
                        }
                    ],
                    command_source: 'sample_data'
                },
                {
                    id: 'KSI-SVC-01',
                    category: 'Service Configuration',
                    status: 'failed',
                    description: 'Enforce encryption in transit for all network communications',
                    commands_executed: 2,
                    successful_commands: 1,
                    failed_commands: 1,
                    cli_command: '2 commands (1 successful): aws elbv2 describe-listeners; aws acm list-certificates',
                    assertion_reason: '‚ùå TLS enforcement not properly configured for all load balancers: ‚úÖ Load balancer listeners configured; ‚ùå Missing SSL/TLS certificates for secure communication',
                    requirement: 'TLS 1.2+ required for all communications',
                    timestamp: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), // 5 days ago
                    detailed_commands: [
                        {
                            command: 'aws elbv2 describe-listeners --output json',
                            description: 'Check listener configurations for TLS settings',
                            status: 'success',
                            execution_time: '0.8s',
                            source: 'sample_data'
                        },
                        {
                            command: 'aws acm list-certificates --output json',
                            description: 'Validate SSL/TLS certificates',
                            status: 'failed',
                            execution_time: '0.5s',
                            source: 'sample_data'
                        }
                    ],
                    command_source: 'sample_failed'
                },
                {
                    id: 'KSI-LOG-03',
                    category: 'Audit Logging',
                    status: 'warning',
                    description: 'Ensure log retention meets compliance requirements',
                    commands_executed: 3,
                    successful_commands: 2,
                    failed_commands: 1,
                    cli_command: '3 commands (2 successful): aws logs describe-log-groups; aws s3api get-bucket-logging; aws cloudtrail get-trail-status',
                    assertion_reason: '‚ö†Ô∏è Partial compliance: Most logs retained properly but some short-term retention detected',
                    requirement: 'Audit logs must be retained for minimum compliance period',
                    timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 days ago
                    detailed_commands: [],
                    command_source: 'sample_partial'
                },
                {
                    id: 'KSI-NET-02',
                    category: 'Network Security',
                    status: 'passed',
                    description: 'Network segmentation controls properly configured',
                    commands_executed: 4,
                    successful_commands: 4,
                    failed_commands: 0,
                    cli_command: '4 commands (4 successful): aws ec2 describe-vpcs; aws ec2 describe-subnets; aws ec2 describe-security-groups; aws ec2 describe-network-acls',
                    assertion_reason: '‚úÖ Network segmentation controls properly configured',
                    requirement: 'Proper network isolation and access controls',
                    timestamp: new Date(Date.now() - 45 * 24 * 60 * 60 * 1000).toISOString(), // 45 days ago (stale)
                    detailed_commands: [],
                    command_source: 'sample_stale'
                }
            ];

            // Process enhancement opportunities for passed KSIs
            allKsis.forEach(ksi => {
                if (ksi.status === 'passed' && !ksi.hasEnhancements) {
                    const enhancements = detectEnhancementOpportunities(ksi.assertion_reason, ksi.status);
                    if (enhancements.length > 0) {
                        ksi.hasEnhancements = true;
                        ksi.enhancements = enhancements;
                    }
                }
            });
        }

        // ‚úÖ ENHANCED: Load real data with command register support
        async function loadRealData() {
            try {
                console.log('üîÑ Starting data loading process...');
                
                // ‚úÖ STEP 1: Load command register first
                await loadCommandRegister();
                
                // ‚úÖ STEP 2: Load validation data
                console.log('üîÑ Loading validation data...');
                const response = await fetch('./unified_ksi_validations.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Validation data loaded successfully');
                
                updateDashboardWithRealData(data);
                showDataSourceNotification('live');
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Could not load real data, using sample data:', error.message);
                initializeSampleData();
                showDataSourceNotification('sample');
            }
        }

        // ‚úÖ ENHANCED: Update dashboard with extracted command details
        function updateDashboardWithRealData(data) {
            try {
                let validations = [];
                let dataTimestamp = null;
                
                // Extract timestamp
                if (data.metadata && data.metadata.generated_at) {
                    dataTimestamp = new Date(data.metadata.generated_at);
                } else if (data.generated_at) {
                    dataTimestamp = new Date(data.generated_at);
                } else if (data.timestamp) {
                    dataTimestamp = new Date(data.timestamp);
                }
                
                // Extract validation array
                if (Array.isArray(data)) {
                    validations = data;
                } else if (data.validations && Array.isArray(data.validations)) {
                    validations = data.validations;
                }

                if (validations.length === 0) {
                    throw new Error('No validation data found in the loaded JSON');
                }

                // ‚úÖ ENHANCED: Process with command details extraction
                allKsis = validations.map(validation => {
                    const commandDetails = extractCommandDetails(validation);
                    
                    const ksi = {
                        id: validation.ksi_id || validation.validation_id || 'Unknown',
                        status: (validation.assertion === true || validation.assertion === "true") ? 
                            'passed' : 
                            (validation.assertion === false || validation.assertion === "false") ? 
                                'failed' : 'unknown',
                        category: validation.long_name || validation.category || 'Unknown Category',
                        description: validation.requirement || validation.description || 'No description available',
                        commands_executed: validation.commands_executed || 0,
                        successful_commands: validation.successful_commands || 0,
                        failed_commands: validation.failed_commands || 0,
                        cli_command: validation.cli_command || 'No command information',
                        assertion_reason: validation.assertion_reason || 'No assessment details provided',
                        timestamp: validation.timestamp || validation.validation_timestamp || null,
                        validation_method: validation.validation_method || 'automated',
                        evidence_path: validation.evidence_path || '',
                        requirement: validation.requirement || 'No requirement specified',
                        rawData: validation,
                        // ‚úÖ ENHANCED: Rich command details from register or fallback
                        detailed_commands: commandDetails.commands || [],
                        command_source: commandDetails.source || 'unknown',
                        register_description: commandDetails.description || null,
                        register_justification: commandDetails.justification || null
                    };

                    // Detect enhancement opportunities for passed KSIs
                    if (ksi.status === 'passed') {
                        const enhancements = detectEnhancementOpportunities(ksi.assertion_reason, ksi.status);
                        if (enhancements.length > 0) {
                            ksi.hasEnhancements = true;
                            ksi.enhancements = enhancements;
                        }
                    }

                    return ksi;
                });

                console.log(`üìä Processed ${allKsis.length} KSI validation records`);
                
                // Log command register usage
                const registerUsage = allKsis.filter(k => k.command_source === 'comprehensive_register').length;
                const fallbackUsage = allKsis.filter(k => k.command_source === 'validation_summary').length;
                console.log(`üéØ Command sources: ${registerUsage} from register, ${fallbackUsage} from fallback`);
                
                updateMetrics();
                populateCategoryFilter();
                filterKsis();
                
                if (dataTimestamp) {
                    updateTimestampsWithData(dataTimestamp);
                } else {
                    updateTimestamps();
                }
                
            } catch (error) {
                console.error('‚ùå Error processing real data:', error);
                showDataSourceNotification('error');
                initializeSampleData();
            }
        }

        function renderKsis() {
            const grid = document.getElementById('ksi-grid');
            
            if (filteredKsis.length === 0) {
                grid.innerHTML = `
                    <div class="loading">
                        <h3>üîç No KSIs Found</h3>
                        <p>No KSIs match your current search criteria.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredKsis.map(ksi => {
                const cleanResult = cleanAssertionReason(ksi.assertion_reason, ksi.status);
                const hasEnhancements = ksi.hasEnhancements && ksi.enhancements && ksi.enhancements.length > 0;
                
                return `
                <div class="ksi-card ${ksi.status} ${hasEnhancements ? 'enhancement' : ''}">
                    <div class="ksi-card-header">
                        <div class="ksi-id">${ksi.id}</div>
                        <div class="ksi-status status-${ksi.status}">
                            ${getStatusIcon(ksi.status)} ${ksi.status.toUpperCase()}
                        </div>
                    </div>
                    
                    <div class="ksi-category">${ksi.category}</div>
                    <div class="ksi-description">${ksi.description}</div>
                    
                    ${hasEnhancements ? `
                        <div class="enhancement-badge">
                            üìà ${ksi.enhancements.length} Enhancement Opportunit${ksi.enhancements.length === 1 ? 'y' : 'ies'}
                        </div>
                        ${ksi.enhancements.slice(0, 2).map(enh => `
                            <div class="enhancement-opportunity">
                                <div class="title">${enh.type} (${enh.priority})</div>
                                <div class="description">${enh.evidence}</div>
                            </div>
                        `).join('')}
                    ` : ''}
                    
                    <div class="ksi-meta">
                        <div class="meta-item">
                            <div class="meta-value">${ksi.commands_executed}</div>
                            <div class="meta-label">Commands</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-value">${ksi.status === 'passed' ? '100%' : ksi.status === 'failed' ? '0%' : '50%'}</div>
                            <div class="meta-label">Success</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-value">${hasEnhancements ? ksi.enhancements.length : 0}</div>
                            <div class="meta-label">Enhance</div>
                        </div>
                    </div>
                    
                    <div class="ksi-result">
                        <div class="result-summary">${cleanResult}</div>
                    </div>
                    
                    <div class="ksi-actions">
                        <button class="action-btn primary" onclick="showCommandsModal('${ksi.id}')">
                            ‚ö° Commands
                        </button>
                        <button class="action-btn secondary" onclick="showWhyModal('${ksi.id}')">
                            ü§î Why ${ksi.status === 'passed' ? 'Pass' : ksi.status === 'failed' ? 'Fail' : 'Result'}
                        </button>
                        ${hasEnhancements ? `
                            <button class="action-btn enhancement" onclick="window.showEnhancementModal('${ksi.id}')">
                                üìà Enhance
                            </button>
                        ` : ''}
                        ${ksi.status === 'failed' ? `
                            <button class="action-btn danger" onclick="createGitHubIssue('${ksi.id}')">
                                üêõ Issue
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            }).join('');
        }

        
        // Generate user-friendly summaries for KSI results
function generateKsiSummary(assertion_reason, status) {
    if (!assertion_reason) return 'No assessment details available';
    
    // For passed KSIs, show simple positive summaries
    if (status === 'passed') {
        const lowerReason = assertion_reason.toLowerCase();
        
        if (lowerReason.includes('security groups') || lowerReason.includes('firewall')) {
            return '‚úÖ Network security controls are properly configured';
        }
        if (lowerReason.includes('encryption') || lowerReason.includes('tls') || lowerReason.includes('ssl')) {
            return '‚úÖ Encryption and data protection controls are active';
        }
        if (lowerReason.includes('logging') || lowerReason.includes('audit') || lowerReason.includes('cloudtrail')) {
            return '‚úÖ Security logging and monitoring are operational';
        }
        if (lowerReason.includes('access control') || lowerReason.includes('iam') || lowerReason.includes('permissions')) {
            return '‚úÖ Access controls and permissions are properly managed';
        }
        if (lowerReason.includes('change management') || lowerReason.includes('deployment')) {
            return '‚úÖ Change management processes are implemented';
        }
        if (lowerReason.includes('training') || lowerReason.includes('education')) {
            return '‚úÖ Security training and awareness programs are active';
        }
        if (lowerReason.includes('network') || lowerReason.includes('segmentation')) {
            return '‚úÖ Network architecture and segmentation are secure';
        }
        if (lowerReason.includes('immutable') || lowerReason.includes('infrastructure')) {
            return '‚úÖ Infrastructure deployment controls are operational';
        }
        
        // Default positive summary
        return '‚úÖ Security control is properly implemented and operational';
    }
    
    // For failed/warning KSIs, show more detailed but cleaned info
    let cleaned = assertion_reason
        .replace(/‚úÖ|‚ùå|‚ö†Ô∏è|üîç|üìä|üõ°Ô∏è/g, '')
        .replace(/\s+/g, ' ')
        .trim();
    
    const sentences = cleaned.split(/[.!;]/);
    let mainMessage = sentences[0].trim();
    
    if (mainMessage.length > 100) {
        mainMessage = mainMessage.substring(0, 100) + '...';
    }
    
    const statusIcon = assertion_reason.includes('‚úÖ') ? '‚úÖ' : 
                      assertion_reason.includes('‚ùå') ? '‚ùå' : 
                      assertion_reason.includes('‚ö†Ô∏è') ? '‚ö†Ô∏è' : '';
    
    return statusIcon + ' ' + mainMessage;
}

// Keep old function name as alias for compatibility
function cleanAssertionReason(reason, status) {
    return generateKsiSummary(reason, status);
}

        function showDataSourceNotification(type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;

            if (type === 'live') {
                notification.style.background = 'rgba(16, 185, 129, 0.9)';
                notification.style.color = 'white';
                notification.textContent = '‚úÖ Live data loaded';
            } else if (type === 'sample') {
                notification.style.background = 'rgba(245, 158, 11, 0.9)';
                notification.style.color = 'white';
                notification.textContent = '‚ö†Ô∏è Using sample data with KSI-CNA-02 showcase';
            } else if (type === 'error') {
                notification.style.background = 'rgba(239, 68, 68, 0.9)';
                notification.style.color = 'white';
                notification.textContent = '‚ùå Data load error';
            }

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function updateMetrics() {
            const totalKsis = allKsis.length;
            const passedCount = allKsis.filter(ksi => ksi.status === 'passed').length;
            const failedCount = allKsis.filter(ksi => ksi.status === 'failed').length;
            const warningCount = allKsis.filter(ksi => ksi.status === 'warning').length;
            const enhancementCount = allKsis.filter(ksi => ksi.hasEnhancements).length;
            const overallScore = totalKsis > 0 ? Math.round(((passedCount + warningCount * 0.5) / totalKsis) * 100 * 10) / 10 : 0;

            document.getElementById('overall-score').textContent = overallScore + '%';
            document.getElementById('passed-count').textContent = passedCount;
            document.getElementById('failed-count').textContent = failedCount;
            document.getElementById('enhancement-count').textContent = enhancementCount;
            
            console.log(`üìä Metrics updated: ${passedCount}/${totalKsis} passed (${overallScore}%), ${enhancementCount} enhancements`);
        }

        function populateCategoryFilter() {
            const categories = [...new Set(allKsis.map(ksi => ksi.category))].sort();
            const categoryFilter = document.getElementById('category-filter');
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        function filterKsis() {
            const searchTerm = currentFilters.search.toLowerCase();
            const statusFilter = currentFilters.status;
            const categoryFilter = currentFilters.category;

            filteredKsis = allKsis.filter(ksi => {
                const matchesSearch = !searchTerm || 
                    ksi.id.toLowerCase().includes(searchTerm) ||
                    ksi.description.toLowerCase().includes(searchTerm) ||
                    ksi.category.toLowerCase().includes(searchTerm);
                
                // Enhanced status filtering to include enhancement filter
                let matchesStatus = true;
                if (statusFilter === 'enhancement') {
                    matchesStatus = ksi.hasEnhancements === true;
                } else if (statusFilter) {
                    matchesStatus = ksi.status === statusFilter;
                }
                
                const matchesCategory = !categoryFilter || ksi.category === categoryFilter;
                
                return matchesSearch && matchesStatus && matchesCategory;
            });

            renderKsis();
            updateFilterChips();
        }

        function getStatusIcon(status) {
            const icons = {
                passed: '‚úÖ',
                failed: '‚ùå',
                warning: '‚ö†Ô∏è'
            };
            return icons[status] || '‚ùì';
        }

        function updateFilterChips() {
            const chips = document.querySelectorAll('.filter-chip');
            chips.forEach(chip => {
                const status = chip.getAttribute('data-status');
                chip.classList.toggle('active', status === currentFilters.status);
            });
        }

        function setupEventListeners() {
            document.getElementById('search-input').addEventListener('input', (e) => {
                currentFilters.search = e.target.value;
                filterKsis();
            });

            document.getElementById('status-filter').addEventListener('change', (e) => {
                currentFilters.status = e.target.value;
                filterKsis();
            });

            document.getElementById('category-filter').addEventListener('change', (e) => {
                currentFilters.category = e.target.value;
                filterKsis();
            });

            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    const status = chip.getAttribute('data-status');
                    currentFilters.status = status;
                    document.getElementById('status-filter').value = status;
                    filterKsis();
                });
            });
        }

        // ‚úÖ ENHANCED: Show Commands Modal with comprehensive display
        function showCommandsModal(ksiId) {
            const ksi = allKsis.find(k => k.id === ksiId);
            if (!ksi) return;

            const modalTitle = document.getElementById('commands-modal-title');
            const modalBody = document.getElementById('commands-modal-body');

            modalTitle.innerHTML = `‚ö° Commands for ${ksi.id}`;

            const commands = ksi.detailed_commands || [];
            const totalCommands = ksi.commands_executed || 0;
            const successfulCommands = ksi.successful_commands || 0;
            const failedCommands = ksi.failed_commands || 0;
            
            // ‚úÖ ENHANCED: Data source badge
            const sourceBadgeInfo = getDataSourceBadge(ksi.command_source, commands.length, totalCommands);
            
            if (commands.length === 0) {
                modalBody.innerHTML = `
                    <div class="data-source-badge limited">
                        <span>‚ùå</span>
                        <span>No Command Details Available</span>
                    </div>
                    <div class="no-commands-message">
                        <div class="no-commands-icon">üìã</div>
                        <h3>No Detailed Command Information Available</h3>
                        <p>This KSI validation executed <strong>${totalCommands || 0}</strong> commands, but detailed command information is not available.</p>
                        <p><strong>Primary CLI Pattern:</strong></p>
                        <div class="command-code">${ksi.cli_command || 'No command information available'}</div>
                        <p><em>For full command details, check the comprehensive command register or CLI Details modal.</em></p>
                    </div>
                `;
            } else {
                modalBody.innerHTML = `
                    ${sourceBadgeInfo.html}
                    
                    <div class="commands-summary">
                        <h4 class="commands-summary-title">üìä Execution Summary</h4>
                        <div class="commands-stats">
                            <div class="command-stat">
                                <div class="command-stat-value">${totalCommands}</div>
                                <div class="command-stat-label">Total</div>
                            </div>
                            <div class="command-stat">
                                <div class="command-stat-value">${commands.length}</div>
                                <div class="command-stat-label">Detailed</div>
                            </div>
                            <div class="command-stat">
                                <div class="command-stat-value">${successfulCommands}</div>
                                <div class="command-stat-label">Successful</div>
                            </div>
                            <div class="command-stat">
                                <div class="command-stat-value">${totalCommands > 0 ? Math.round((successfulCommands / totalCommands) * 100) : 0}%</div>
                                <div class="command-stat-label">Success Rate</div>
                            </div>
                        </div>
                        ${ksi.register_description ? `<p><strong>Description:</strong> ${ksi.register_description}</p>` : ''}
                        ${ksi.register_justification ? `<p><strong>Justification:</strong> ${ksi.register_justification}</p>` : ''}
                    </div>

                    <div class="commands-list">
                        <h4 style="margin-bottom: 1rem; color: var(--text-primary);">üìã Command Details</h4>
                        ${commands.map((cmd, index) => `
                            <div class="command-item">
                                <div class="command-header" onclick="toggleCommandDetails(${index})">
                                    <div class="command-title">
                                        <span class="command-status ${cmd.status}">${getCommandStatusIcon(cmd.status)} ${cmd.status.toUpperCase()}</span>
                                        ${cmd.description}
                                    </div>
                                    <button class="command-expand-btn" id="expand-btn-${index}">‚ñº</button>
                                </div>
                                <div class="command-details" id="command-details-${index}">
                                    <p><strong>Description:</strong> ${cmd.description}</p>
                                    <div class="command-code">${cmd.command}</div>
                                    <div class="command-meta">
                                        <div class="command-meta-item">
                                            <div class="command-meta-value">${cmd.status}</div>
                                            <div class="command-meta-label">Status</div>
                                        </div>
                                        <div class="command-meta-item">
                                            <div class="command-meta-value">${cmd.execution_time}</div>
                                            <div class="command-meta-label">Duration</div>
                                        </div>
                                        <div class="command-meta-item">
                                            <div class="command-meta-value">${cmd.source || 'unknown'}</div>
                                            <div class="command-meta-label">Source</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        
                        ${totalCommands > commands.length ? `
                            <div style="background: var(--bg-accent); padding: 1rem; border-radius: 8px; text-align: center; margin-top: 1rem; border: 1px solid var(--border-color);">
                                <p style="color: var(--text-secondary); margin: 0;">
                                    <strong>Note:</strong> ${totalCommands - commands.length} additional commands were executed but details are not available in this view.
                                </p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            document.getElementById('commands-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // ‚úÖ NEW: Generate data source badge information
        function getDataSourceBadge(source, detailCount, totalCount) {
            switch (source) {
                case 'comprehensive_register':
                    return {
                        html: `
                            <div class="data-source-badge comprehensive">
                                <span>‚úÖ</span>
                                <span>Full Command Details Available - Showing all ${detailCount} commands from comprehensive command register</span>
                            </div>
                        `,
                        type: 'comprehensive'
                    };
                case 'validation_summary':
                    return {
                        html: `
                            <div class="data-source-badge fallback">
                                <span>‚ö†Ô∏è</span>
                                <span>Parsed from Validation Summary - Showing ${detailCount} of ${totalCount} commands (command register not available)</span>
                            </div>
                        `,
                        type: 'fallback'
                    };
                default:
                    return {
                        html: `
                            <div class="data-source-badge limited">
                                <span>‚ùå</span>
                                <span>Limited Command Information - No detailed command data available</span>
                            </div>
                        `,
                        type: 'limited'
                    };
            }
        }

        function getCommandStatusIcon(status) {
            const icons = {
                success: '‚úÖ',
                failed: '‚ùå',
                unknown: '‚ùì'
            };
            return icons[status] || '‚ùì';
        }

        function toggleCommandDetails(index) {
            const details = document.getElementById(`command-details-${index}`);
            const button = document.getElementById(`expand-btn-${index}`);
            
            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                button.classList.remove('expanded');
            } else {
                details.classList.add('expanded');
                button.classList.add('expanded');
            }
        }

        function showWhyModal(ksiId) {
            const ksi = allKsis.find(k => k.id === ksiId);
            if (!ksi) return;

            const modalTitle = document.getElementById('why-modal-title');
            const modalBody = document.getElementById('why-modal-body');

            const statusText = ksi.status === 'passed' ? 'Pass' : 
                              ksi.status === 'failed' ? 'Fail' : 'Result';
            const statusIcon = getStatusIcon(ksi.status);
            
            modalTitle.innerHTML = `ü§î Why ${statusText}? - ${ksi.id}`;

            // Parse and clean up the assertion reason
            const cleanedAssessment = parseAndCleanAssessment(ksi.assertion_reason);

            modalBody.innerHTML = `
                <div style="background: var(--bg-accent); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid var(--border-color);">
                    <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        üìä Assessment Summary
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                        <div style="text-align: center; background: var(--bg-secondary); padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color);">
                            <div style="font-size: 1.5rem; font-weight: 800; color: var(--text-primary);">${statusIcon} ${statusText.toUpperCase()}</div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 0.25rem;">STATUS</div>
                        </div>
                        <div style="text-align: center; background: var(--bg-secondary); padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color);">
                            <div style="font-size: 1.5rem; font-weight: 800; color: var(--text-primary);">${ksi.commands_executed || 0}</div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 0.25rem;">COMMANDS</div>
                        </div>
                        <div style="text-align: center; background: var(--bg-secondary); padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color);">
                            <div style="font-size: 1.5rem; font-weight: 800; color: var(--text-primary);">${ksi.status === 'passed' ? '100%' : ksi.status === 'failed' ? '0%' : '50%'}</div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 0.25rem;">SUCCESS</div>
                        </div>
                        ${ksi.hasEnhancements ? `
                            <div style="text-align: center; background: var(--bg-secondary); padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color);">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--enhancement-500);">${ksi.enhancements.length}</div>
                                <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 0.25rem;">ENHANCEMENTS</div>
                            </div>
                        ` : ''}
                    </div>
                    <p><strong>Category:</strong> ${ksi.category}</p>
                    <p><strong>Validation Method:</strong> ${ksi.validation_method || 'Automated'}</p>
                </div>
                
                <div style="background: var(--bg-accent); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid var(--border-color);">
                    <h4 style="margin-bottom: 1rem;">üéØ Requirement & Assessment</h4>
                    <p><strong>Requirement:</strong> ${ksi.requirement}</p>
                    <div style="margin-top: 1rem;">
                        <strong>Assessment Result:</strong>
                        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 8px; margin-top: 0.5rem; border: 1px solid var(--border-color);">
                            ${cleanedAssessment}
                        </div>
                    </div>
                </div>

                ${ksi.hasEnhancements ? `
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid var(--enhancement-500); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h4 style="color: var(--enhancement-600); margin-bottom: 1rem;">üìà Enhancement Opportunities Identified</h4>
                        ${ksi.enhancements.map(enh => `
                            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 6px; margin-bottom: 0.5rem; border: 1px solid var(--border-color);">
                                <div style="font-weight: 600; color: var(--enhancement-600);">${enh.type} (${enh.priority} Priority)</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">${enh.description}</div>
                                <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 0.25rem;"><em>Evidence: ${enh.evidence}</em></div>
                            </div>
                        `).join('')}
                        <div style="margin-top: 1rem;">
                            <button onclick="window.showEnhancementModal('${ksi.id}')" class="action-btn enhancement">
                                üìà View Enhancement Plan
                            </button>
                        </div>
                    </div>
                ` : ''}
                
                <div style="background: var(--bg-accent); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border-color);">
                    <h4 style="margin-bottom: 1rem;">üîß Technical Information</h4>
                    <p><strong>Commands Executed:</strong> ${ksi.commands_executed || 0} (${ksi.successful_commands || 0} successful, ${ksi.failed_commands || 0} failed)</p>
                    <p><strong>Command Source:</strong> ${ksi.command_source || 'Unknown'}</p>
                    <p><strong>Evidence Path:</strong> ${ksi.evidence_path || 'No specific path'}</p>
                    ${ksi.timestamp ? `<p><strong>Last Validated:</strong> ${formatTimestamp(ksi.timestamp)}</p>` : ''}
                </div>
            `;

            document.getElementById('why-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Clean up and parse assessment results for better readability
        function parseAndCleanAssessment(assertionReason) {
            if (!assertionReason) return 'No assessment details available';
            
            // Remove excessive technical symbols and clean up
            let cleaned = assertionReason
                .replace(/‚úÖ|‚ùå|‚ö†Ô∏è/g, '') // Remove status emojis temporarily
                .replace(/\s+/g, ' ')
                .trim();

            // Split into key findings
            const findings = [];
            const parts = assertionReason.split(/[;:]/);
            
            parts.forEach(part => {
                const trimmed = part.trim();
                if (trimmed.length > 10) {
                    // Restore status indicators
                    let status = 'üîµ';
                    if (trimmed.includes('‚úÖ')) status = '‚úÖ';
                    else if (trimmed.includes('‚ùå')) status = '‚ùå';
                    else if (trimmed.includes('‚ö†Ô∏è')) status = '‚ö†Ô∏è';
                    
                    // Clean the text
                    const cleanText = trimmed
                        .replace(/‚úÖ|‚ùå|‚ö†Ô∏è/g, '')
                        .replace(/^\s*[:\-]\s*/, '')
                        .trim();
                    
                    if (cleanText.length > 5) {
                        findings.push(`${status} ${cleanText}`);
                    }
                }
            });

            // If we have findings, format them nicely
            if (findings.length > 0) {
                return findings.slice(0, 6).map(finding => 
                    `<div style="margin-bottom: 0.5rem; padding: 0.5rem; background: var(--bg-accent); border-radius: 4px;">${finding}</div>`
                ).join('');
            }

            // Fallback to original but shortened
            const shortened = assertionReason.length > 200 ? 
                assertionReason.substring(0, 200) + '...' : 
                assertionReason;
            
            return shortened;
        }

        function formatTimestamp(timestamp) {
            try {
                return new Date(timestamp).toLocaleString();
            } catch (e) {
                return timestamp;
            }
        }

        function createGitHubIssue(ksiId) {
            const ksi = allKsis.find(k => k.id === ksiId);
            if (!ksi) return;

**KSI ID:** ${ksi.id}
**Category:** ${ksi.category}
**Status:** ${ksi.status.toUpperCase()}

### Description
${ksi.description}

### Technical Details
- **Commands Executed:** ${ksi.commands_executed || 0}
- **CLI Command:** \`${ksi.cli_command || 'N/A'}\`


            const githubUrl = `https://github.com/fedrampgyrus/fedramp_20x_public_submission_live/issues/new?title=${issueTitle}&body=${issueBody}`;
            window.open(githubUrl, '_blank');
        }

        function downloadJSON() {
    // Fetch the actual JSON file and trigger download
    fetch('./unified_ksi_validations.json')
        .then(response => response.json())
        .then(data => {
            const jsonString = JSON.stringify(data, null, 2);
            downloadFile(jsonString, 'unified_ksi_validations.json', 'application/json');
        })
        .catch(error => {
            console.error('Error fetching JSON:', error);
            // Fallback: try direct download approach
            const link = document.createElement('a');
            link.href = './unified_ksi_validations.json';
            link.download = 'unified_ksi_validations.json';
            link.click();
        });
}
        async function viewFailedReport() {
            try {
                const response = await fetch('./failed_ksi_report_readable.md');
                if (response.ok) {
                    const markdown = await response.text();
                    
                    const html = markdown
                        .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                        .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                        .replace(/^### (.+)$/gm, '<h3>$1</h3>')
                        .replace(/^\- (.+)$/gm, '<li>$1</li>')
                        .replace(/(\n\n)/g, '</p><p>')
                        .replace(/^(.+)$/gm, '<p>$1</p>');
                    
                    document.getElementById('markdown-modal-body').innerHTML = html;
                    document.getElementById('markdown-modal').classList.add('active');
                    document.body.style.overflow = 'hidden';
                } else {
                    throw new Error('Could not load report');
                }
            } catch (error) {
                alert('Could not load failed KSI report. Please try again later.');
            }
        }

        // Modal close functions
        function closeCliModal() {
            document.getElementById('cli-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function closeWhyModal() {
            document.getElementById('why-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function closeMarkdownModal() {
            document.getElementById('markdown-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function closeCommandsModal() {
            document.getElementById('commands-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function updateTimestamps() {
            const now = new Date();
            const timeString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            const lastUpdatedEl = document.getElementById('last-updated');
            const headerTimestampEl = document.getElementById('header-timestamp');
            
            if (lastUpdatedEl) {
                lastUpdatedEl.textContent = timeString;
            }
            if (headerTimestampEl) {
                headerTimestampEl.textContent = timeString;
            }
        }

        function updateTimestampsWithData(dataTimestamp) {
            const timeString = dataTimestamp.toLocaleDateString() + ' ' + 
                             dataTimestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            const lastUpdatedEl = document.getElementById('last-updated');
            const headerTimestampEl = document.getElementById('header-timestamp');
            
            if (lastUpdatedEl) {
                lastUpdatedEl.textContent = timeString;
            }
            if (headerTimestampEl) {
                headerTimestampEl.textContent = timeString;
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            document.getElementById('theme-icon').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (tabName === 'compliance') {
                document.getElementById('compliance-tab').classList.add('active');
                document.querySelector('.tab-btn[onclick="showTab(\'compliance\')"]').classList.add('active');
            } else if (tabName === 'trust-center') {
                document.getElementById('trust-center-tab').classList.add('active');
                document.querySelector('.tab-btn[onclick="showTab(\'trust-center\')"]').classList.add('active');
            }
        }

        function scrollToTrustSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        }

        // Download functions
        function downloadIncidentTemplate() {
            const template = {
                incident_id: "INC-YYYY-###",
                classification: "FedRAMP Category 1-5",
                detection_time: "ISO 8601 timestamp",
                affected_systems: ["system boundary identifiers"],
                description: "Detailed incident description",
                remediation_actions: "Response and containment actions",
                fedramp_notification_required: "true/false",
                status: "Open/Resolved/Closed"
            };
            
            const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'fedramp_incident_template.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function downloadClassificationGuide() {
            const guide = `# FedRAMP Incident Classification Guide

## Category 1: Unauthorized Access to Federal Information
- Timeline: Immediate notification (within 1 hour)
- FedRAMP PMO: Required
- Agencies: Immediate notification required

## Category 2: Denial of Service Impacting Federal Operations  
- Timeline: Within 4 hours
- FedRAMP PMO: Required
- Agencies: Within 4 hours

## Category 3: Malicious Code on Federal Systems
- Timeline: Within 4 hours  
- FedRAMP PMO: Required for federal boundaries
- Agencies: Within 4 hours

## Category 4: Improper Usage Affecting Federal Data
- Timeline: Within 24 hours
- FedRAMP PMO: As appropriate
- Agencies: Within 24 hours

## Category 5: Scans/Probes/Attempted Access
- Timeline: Monthly reporting acceptable
- FedRAMP PMO: Summary reporting
- Agencies: As contractually required`;
            
            const blob = new Blob([guide], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'fedramp_incident_classification_guide.md';
            a.click();
            URL.revokeObjectURL(url);
        }

        function initializeDashboard() {
            console.log('üîÑ Initializing three-tier POA&M dashboard...');
            initializeSampleData();
            populateCategoryFilter();
            setupEventListeners();
            filterKsis();
            updateMetrics();
            updateTimestamps();
            loadRealData();
            
            // Test modal elements
            console.log('üß™ Testing modal elements...');
            console.log('- POA&M Modal:', !!document.getElementById('poam-modal'));
            console.log('- Enhancement Modal:', !!document.getElementById('enhancement-modal'));
            console.log('- Commands Modal:', !!document.getElementById('commands-modal'));
            console.log('- Why Modal:', !!document.getElementById('why-modal'));
        }

        // Global functions - Make sure all modal functions are accessible
        window.showWhyModal = showWhyModal;
        window.closeWhyModal = closeWhyModal;
        window.createGitHubIssue = createGitHubIssue;
        window.toggleTheme = toggleTheme;
        window.showTab = showTab;
        window.scrollToTrustSection = scrollToTrustSection;
        window.showCommandsModal = showCommandsModal;
        window.closeCommandsModal = closeCommandsModal;
        window.toggleCommandDetails = toggleCommandDetails;
        window.downloadJSON = downloadJSON;
        window.viewFailedReport = viewFailedReport;
        window.closeMarkdownModal = closeMarkdownModal;
        window.downloadIncidentTemplate = downloadIncidentTemplate;
        window.downloadClassificationGuide = downloadClassificationGuide;
        window.showPOAMModal = showPOAMModal;
        window.closePOAMModal = closePOAMModal;
        window.showPOAMTier = showPOAMTier;
        window.togglePOAMDetails = togglePOAMDetails;
        window.showEnhancementModal = showEnhancementModal;
        window.closeEnhancementModal = closeEnhancementModal;
        window.downloadEnhancementTemplate = downloadEnhancementTemplate;
        window.createEnhancementIssue = createEnhancementIssue;

        // Auto-refresh every 5 minutes
        setInterval(() => {
            updateTimestamps();
            loadRealData();
        }, 300000);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ FedRAMP 20x Trust Center - Three-Tier POA&M System Loading...');
            initializeTheme();
            initializeDashboard();
            
            // Add debug info
            console.log('üîß Debugging: POA&M Modal element exists:', !!document.getElementById('poam-modal'));
            console.log('üîß Debugging: Enhancement Modal element exists:', !!document.getElementById('enhancement-modal'));
            console.log('üîß Debugging: showPOAMModal function available:', typeof window.showPOAMModal);
            console.log('üîß Debugging: showEnhancementModal function available:', typeof window.showEnhancementModal);
            
            const searchBox = document.getElementById('search-input');
            if (searchBox) {
                searchBox.placeholder = 'Search KSIs... (Press / to focus)';
            }
            
            // Federal access form handler
            const form = document.getElementById('federal-access-form');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(e.target);
                    const requestId = `REQ-${Date.now()}`;
                    
                    document.getElementById('form-response').innerHTML = `
                        <div style="background: #fff3cd; border: 1px solid #ffc107; color: #856404; padding: 20px; border-radius: 10px;">
                            <h4>üîÑ Submitting Request...</h4>
                            <p>Creating your federal access request. Please wait...</p>
                        </div>
                    `;
                    
                    try {
                        document.getElementById('form-response').innerHTML = `
                            <div style="background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 20px; border-radius: 10px;">
                                <h4>‚úÖ Request Submitted Successfully</h4>
                                <p><strong>Request ID:</strong> ${requestId}</p>
                                <p>Your federal access request has been created for transparency.</p>
                                <p><strong>Next Steps:</strong> Our team will respond within 24 hours.</p>
                                <p><strong>Questions?</strong> Contact security@gyrus.com</p>
                            </div>
                        `;
                        
                        form.reset();
                    } catch (error) {
                        console.error('Failed to create request:', error);
                        document.getElementById('form-response').innerHTML = `
                            <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 20px; border-radius: 10px;">
                                <h4>‚ùå Submission Failed</h4>
                                <p>We encountered an error creating your request. Please try again or contact us directly.</p>
                                <p><strong>Email:</strong> security@gyrus.com</p>
                            </div>
                        `;
                    }
                });
            }
            
            console.log('‚úÖ Three-Tier POA&M Dashboard initialization complete');
            console.log('üéØ Innovation: First FedRAMP 20x submission with proactive enhancement tracking');
            
            // Test POA&M functionality after a short delay
            setTimeout(() => {
                console.log('üß™ Testing POA&M modal availability...');
                if (typeof window.showPOAMModal === 'function') {
                    console.log('‚úÖ POA&M modal function is ready - buttons should work!');
                } else {
                    console.error('‚ùå POA&M modal function not properly initialized');
                }
            }, 1000);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
                e.preventDefault();
                document.getElementById('search-input').focus();
            }
            if (e.key === 'Escape') {
                closeWhyModal();
                closeCommandsModal();
                closeMarkdownModal();
                closePOAMModal();
                closeEnhancementModal();
            }
        });

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
                


